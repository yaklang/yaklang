# PDF 知识库问题索引质量优化总结

## 问题背景

在构建 PDF 知识库时，AI 生成了大量低质量的问题索引，这些问题存在以下严重问题：

### 典型的低质量问题示例

1. **使用模糊代词**
   - "图像的主要内容是什么？"
   - "图像的场景时间信息是什么？"
   - "图像中的文本标签内容是什么？"
   
2. **使用技术标识符**
   - "title[t_4]的内容是什么？"
   - "label[t_3]和title[t_4]之间存在什么关系？"
   - "标签系统中t_7缩写是什么？"

3. **使用上下文引用**
   - "文档中出现的技术工具名称有哪些？"
   - "场景上下文的内容是什么？"
   - "场景上下文的位置信息是什么？"

4. **视觉布局描述**
   - "图像中位于页面右下角的水平线是什么？"
   - "文档的场景上下文位置是什么？"

### 核心问题

这些问题的共同特点是：**脱离原始上下文后完全无法理解**。它们使用了大量指代词、技术标识符和相对位置描述，导致：
- 用户无法通过这些问题找到他们真正需要的知识
- 搜索索引质量极低，毫无实用价值
- 违背了知识库的基本目的：通过意图驱动的问题找到知识

## 优化方案

### 1. 核心原则强化

在提示词中明确了三个黄金法则：

1. **独立性**：问题必须独立完整，不依赖上下文
2. **具体性**：必须包含具体的产品名/技术名/概念名
3. **意图性**：描述用户想了解的知识，而非文档结构

### 2. 添加严禁模式清单

#### 严禁使用指代词和上下文引用
- ❌ "这个"、"该"、"此"、"上述"
- ❌ "文档中"、"文本中"、"内容中"
- ❌ "上文"、"下文"、"左侧"、"右侧"

#### 严禁使用技术标识符
- ❌ "label[t_3]"、"title[t_4]"、"section_2.3"
- ❌ "0x00部分"、"第X章"

#### 严禁针对图像使用模糊描述
- ❌ "图像的主要内容是什么？"
- ❌ "图片展示了什么？"
- ❌ "该截图显示的界面是什么？"

#### 严禁描述视觉布局
- ❌ "图像中位于页面右下角的水平线是什么？"
- ❌ "文档的场景上下文位置是什么？"

### 3. 推荐的问题语法模式

提供了明确的问题模板：

- "在XXX情况下如何...？" (场景化操作问题)
- "XXX的基本步骤有哪些？" (流程类问题)
- "XXX有哪些YYY元素？" (结构类问题)
- "如何实现XXX？" (实现类问题)
- "XXX的核心概念是什么？" (概念类问题)
- "XXX和YYY有什么区别？" (对比类问题)

### 4. 核心测试标准

**如果一个问题拿给一个没有看过原文的人，他能否理解这个问题在问什么？**
- 如果能理解 → ✅ 这是好问题
- 如果不能理解（需要看原文才知道问的是什么） → ❌ 这是坏问题

### 5. 添加 Few-Shot 示例

在 `search_index_build.txt` 中添加了三个完整的 Few-Shot 示例：

#### 示例 1: Web安全测试工具文档
展示了如何将包含图像描述的文档内容转化为具体的知识问题

#### 示例 2: 安全漏洞技术文档
展示了如何避免使用章节编号和技术标识符

#### 示例 3: 编程技术文档
展示了如何将抽象的"场景上下文"转化为具体的知识问题

每个示例都包含：
- 原始内容片段
- ❌ 错误的问题生成（带问题分析）
- ✅ 正确的问题生成

## 修改的文件

### 1. `/Users/v1ll4n/Projects/yaklang/common/aiforge/liteforge_prompt/search_index_build.txt`

**主要修改：**
- 第5节：扩展了"问题质量要求"，添加独立原子性原则和严禁模式
- 第6节：扩展了"优质问题示例"，添加更多具体案例
- 第7节：扩展了"劣质问题示例"，按类型分类并详细说明
- 新增第8节：图像/视觉内容的严禁模式
- 新增第9节：书籍/PDF知识库的特殊规则
- 新增第10节：问题生成的最佳实践总结
- 新增 Few-Shot 示例部分：三个完整的示例

**文件行数：** 从 85 行扩展到 346 行

### 2. `/Users/v1ll4n/Projects/yaklang/common/aiforge/liteforge_prompt/knowledge_index_build.txt`

**主要修改：**
- 在第2节"生成高质量、用户视角的问题"中添加了"问题质量的严格要求"子节
- 添加了独立原子性原则
- 添加了严禁使用的模式清单
- 添加了推荐的问题语法模式
- 添加了核心测试标准
- 添加了错误问题vs正确问题的示例对比

## 预期效果

优化后的提示词将显著改善问题索引质量：

### Before (优化前)
```json
{
  "question_list": [
    {"question": "图像的主要内容是什么？"},
    {"question": "title[t_4]的内容是什么？"},
    {"question": "场景上下文的位置信息是什么？"},
    {"question": "文档中出现的技术工具名称有哪些？"}
  ]
}
```

### After (优化后)
```json
{
  "question_list": [
    {"question": "Firebug扩展如何安装？"},
    {"question": "Hibernate查询参数如何设置？"},
    {"question": "用户最后登录时间如何存储？"},
    {"question": "setParameter()方法如何防止SQL注入？"}
  ]
}
```

## 关键改进点

1. ✅ 所有问题都包含具体的产品名、技术名或概念名
2. ✅ 所有问题都可以脱离上下文独立理解
3. ✅ 所有问题都是意图驱动的，描述用户想了解的知识
4. ✅ 消除了所有指代词、技术标识符和相对位置描述
5. ✅ 将图像描述转化为具体的知识问题
6. ✅ 将章节结构转化为独立的知识性问题

## 测试建议

建议使用相同的 PDF 文档重新生成知识库索引，对比优化前后的问题质量：

1. 检查是否还存在"图像的..."、"文档中..."等模糊问题
2. 检查是否还存在技术标识符（如"label[t_3]"）
3. 检查每个问题是否可以脱离上下文独立理解
4. 检查问题是否都包含具体的产品名/技术名/概念名

## 维护建议

1. 如果发现新的低质量问题模式，及时添加到"严禁模式"清单中
2. 定期审查生成的问题质量，收集反馈
3. 根据实际使用情况，持续优化 Few-Shot 示例
4. 考虑添加自动化质量检查脚本，过滤低质量问题

---

**优化日期：** 2026-01-04
**优化者：** AI Assistant (Claude Sonnet 4.5)
**相关 Issue：** PDF 知识库问题索引质量优化
