package lowhttp

import (
	"bytes"
	"encoding/hex"
	"fmt"
	"testing"

	"github.com/klauspost/compress/zstd"
	"github.com/stretchr/testify/assert"
	"github.com/stretchr/testify/require"
	"github.com/yaklang/yaklang/common/log"
	"github.com/yaklang/yaklang/common/utils"
	"github.com/yaklang/yaklang/common/yak/yaklib/codec"
)

func TestFixHTTPResponse(t *testing.T) {
	type args struct {
		raw []byte
	}

	gzipData, err := utils.GzipCompress("你好")
	if err != nil {
		panic(err)
	}
	h2packet := `HTTP/2 200 Ok
Test: 111
Content-Encoding: gzip

` + string(gzipData)
	rawResp, _ := codec.DecodeBase64(`SFRUUC8xLjEgMjAwIE9LDQpEYXRlOiBTdW4sIDI2IEZlYiAyMDIzIDAzOjQ0OjUzIEdNVA0KU2VydmVyOiBBcGFjaGUNClgtUG93ZXJlZC1CeTogUEhQLzUuMi4xNw0KRXhwaXJlczogVGh1LCAxOSBOb3YgMTk4MSAwODo1MjowMCBHTVQNCkNhY2hlLUNvbnRyb2w6IG5vLXN0b3JlLCBuby1jYWNoZSwgbXVzdC1yZXZhbGlkYXRlLCBwb3N0LWNoZWNrPTAsIHByZS1jaGVjaz0wDQpQcmFnbWE6IG5vLWNhY2hlDQpTZXQtQ29va2llOiBQSFBTRVNTSUQ9dmFsdWU7IGh0dHBPbmx5DQpWYXJ5OiBVc2VyLUFnZW50LEFjY2VwdC1FbmNvZGluZw0KVHJhbnNmZXItRW5jb2Rpbmc6IGNodW5rZWQNCkNvbnRlbnQtVHlwZTogdGV4dC9odG1sDQoNCjFmDQrmj5DkuqTluKbmnInkuI3lkIjms5Xlj4LmlbANCjANCg0K`)

	jsonChineseOrigin := `HTTP/1.1 200 OK
Connection: keep-alive
Content-Encoding: identity
Content-Type: application/json; charset=utf-8
Date: Mon, 21 Nov 2022 07:54:18 GMT
Edocecart: 32581202071201156071176630638112115
Server: BWS
Traceid: 1669017258039822849010147292226863610359
Vary: Accept-Encoding
Content-Length: 1033

{
    "errno": 0,
    "error": "\u6210\u529f",
    "data": {
        "requestParam": [],
        "response": {
            "cnt": {
                "fansCnt": 182881,
                "fansCntText": "18\u4e07\u7c89\u4e1d",
                "videoCount": 11961,
                "videoCntText": "1.2\u4e07\u4e2a\u89c6\u9891",
                "totalPlaycnt": 0,
                "totalPlaycntText": ""
            },
            "author": {
                "vip": 1,
                "author": "\u6293\u9a6c\u77ed\u661f\u95fb",
                "author_icon": "https:\/\/gimg0.baidu.com\/gimg\/src=https%3A%2F%2Fgips0.baidu.com%2Fit%2Fu%3D2476551077%2C1418779011%26fm%3D3012%26app%3D3012%26autime%3D1667425861%26size%3Db200%2C200&refer=http%3A%2F%2Fwww.baidu.com&app=0&size=f68,68&n=0&g=0n&q=60?sec=0&t=d9946543ab888fe6d5d9c1fb9991428c&fmt=auto",
                "mthid": "1680416484715223",
                "authentication_content": "\u5a31\u4e50\u9886\u57df\u521b\u4f5c\u8005"
            },
            "is_subscribe": 0
        }
    }
}`

	rapInput := `HTTP/1.1 200 OK
Connection: close
Bdpagetype: 3
Bdqid: 0x9efbfb790011d570
Cache-Control: private
Ckpacknum: 2
Ckrndstr: 90011d570
Content-Encoding: gzip
Content-Type: text/html;charset=utf-8
Date: Sat, 27 Nov 2021 04:20:29 GMT
P3p: CP=" OTI DSP COR IVA OUR IND COM "
Server: BWS/1.1
Set-Cookie: BDRCVFR[S4-dAuiWMmn]=I67x6TjHwwYf0; path=/; domain=.baidu.com
Set-Cookie: delPer=0; path=/; domain=.baidu.com
Set-Cookie: BD_CK_SAM=1;path=/
Set-Cookie: PSINO=2; domain=.baidu.com; path=/
Set-Cookie: BDSVRTM=12; path=/
Set-Cookie: H_PS_PSSID=34445_35104_35239_34584_34517_35245_34606_35320_26350_35209_35312_35145; path=/; domain=.baidu.com
Strict-Transport-Security: max-age=172800
Traceid: 1637986829039139149811456026574257771888
Vary: Accept-Encoding
X-Frame-Options: sameorigin
X-Ua-Compatible: IE=Edge,chrome=1
Content-Length: 12

aaaaaaaaaaaa` + "\r\n\r\n"

	jsonEcho := `HTTP/1.1 200 OK
Date: Thu, 16 Nov 2023 08:42:33 GMT
Content-Type: application/json

{"key":"value"}`

	chunk2, _ := codec.DecodeBase64(`SFRUUC8xLjEgMjAwIE9LDQpTZXJ2ZXI6IEFwYWNoZS1Db3lvdGUvMS4xDQp4LWZyYW1lLW9wdGlvbnM6IFNBTUVPUklHSU4NCkNhY2hlLUNvbnRyb2w6IG5vLWNhY2hlDQpDb250ZW50LVR5cGU6IHRleHQveG1sO2NoYXJzZXQ9R0JLDQpUcmFuc2Zlci1FbmNvZGluZzogY2h1bmtlZA0KVmFyeTogQWNjZXB0LUVuY29kaW5nDQpEYXRlOiBUdWUsIDA3IE1hciAyMDIzIDAzOjM1OjQ1IEdNVA0KDQoyMDAwDQp7Il9fdHlwZSI6ImV4dFRyYW5zIiwic3Vic2V0IjoiIiwibWVzc2FnZSI6IrLZ1/fWtNDQs8m5piEiLCJhcHBseUNvZGVEZXNjIjoiyee74dXQxrgiLCJzdWNjZWVkIjp0cnVlLCJDYW5kaWRhdGUiOnsiaXRlbWRlc2MiOiLTpsa4ye233SIsIml0ZW10eXBlIjoiQSIsImNvZGVzZXRpZCI6IjM1IiwiaXRlbWxlbmd0aCI6MiwiaXRlbWlkIjoiYTAxY3oiLCJleHBsYWluIjoiIiwiZGVjaW1hbCI6MH0sInJldHVybl9kYXRhIjp7Im1heF9maWxlc2l6ZSI6IjEwIiwibXVzdEZsYWciOmZhbHNlLCJhbnN3ZXJTZXQiOiIiLCJ3cml0ZWFibGUiOiIxIiwiY29kZURhdGEiOm51bGwsInBob3RvX3NpemUiOiI1MTIiLCJwaG90byI6IiIsIm11c3RfdXBsb2FkIjoiMSIsImlzQXR0YWNoQ29kZXNldCI6dHJ1ZSwiZmllbGRfbGlzdCI6eyJBQlEiOnsicmVjb3JkIjoibm8iLCJkYXRhbGlzdCI6W1t7ImNvZGVzZXRpZCI6IjAiLCJpdGVtdHlwZSI6Ik0iLCJpdGVtZGVzYyI6ItGnyfq5pNf3vq3A+iIsIml0ZW1sZW5ndGgiOjEwLCJvbmx5X2ZpZWxkIjoiMCIsImxheWVyIjoiMCIsIml0ZW1pZCI6IkFCUUFBIiwiZXhwbGFpbiI6IiIsImRlY2ltYWwiOjAsImxlYWZfb25seSI6IjAiLCJtdXN0IjoiMSIsImRpc3BsYXluYW1lIjoiIn0seyJmaWxlX2xpc3QiOm51bGx9XV19LCJBQVAiOnsicmVjb3JkIjoibm8iLCJkYXRhbGlzdCI6W1t7ImNvZGVzZXRpZCI6IjAiLCJpdGVtdHlwZSI6Ik0iLCJpdGVtZGVzYyI6ItOmxri2r7v6IiwiaXRlbWxlbmd0aCI6MTAsIm9ubHlfZmllbGQiOiIwIiwibGF5ZXIiOiIwIiwiaXRlbWlkIjoiQUFQQUEiLCJleHBsYWluIjoiIiwiZGVjaW1hbCI6MCwibGVhZl9vbmx5IjoiMCIsIm11c3QiOiIxIiwiZGlzcGxheW5hbWUiOiIifSx7ImZpbGVfbGlzdCI6bnVsbH1dXX0sIkExOSI6eyJyZWNvcmQiOiJubyIsImRhdGFsaXN0IjpbW3siY29kZXNldGlkIjoiMCIsIml0ZW10eXBlIjoiTSIsIml0ZW1kZXNjIjoiuaTX96OoxeDRtaOpvq3A+rG416IiLCJpdGVtbGVuZ3RoIjo1MCwib25seV9maWVsZCI6IjAiLCJsYXllciI6IjAiLCJpdGVtaWQiOiJBMTlBSiIsImV4cGxhaW4iOiLA/cjno7p4IMTqeNTCLXjE6njUwqOseLWlzrt4uNrOu3jWsM7xo6zI5860ss6807mk1/ejrMfrzO7QtM7eoaMiLCJkZWNpbWFsIjowLCJsZWFmX29ubHkiOiIwIiwibXVzdCI6IjEiLCJkaXNwbGF5bmFtZSI6IiJ9LHsiZmlsZV9saXN0IjpudWxsfV1dfSwiQTQ5Ijp7InJlY29yZCI6Im5vIiwiZGF0YWxpc3QiOltbeyJjb2Rlc2V0aWQiOiIwIiwiaXRlbXR5cGUiOiJNIiwiaXRlbWRlc2MiOiK9sbPNx+m/9iIsIml0ZW1sZW5ndGgiOjEwLCJvbmx5X2ZpZWxkIjoiMCIsImxheWVyIjoiMCIsIml0ZW1pZCI6IkE0OUFFIiwiZXhwbGFpbiI6IiIsImRlY2ltYWwiOjAsImxlYWZfb25seSI6IjAiLCJtdXN0IjoiMSIsImRpc3BsYXluYW1lIjoivbGzzcfpv/YifSx7ImZpbGVfbGlzdCI6bnVsbH1dXX0sIkE3OSI6eyJyZWNvcmQiOiJubyIsImRhdGFsaXN0IjpbW3siY29kZXNldGlkIjoiMCIsIml0ZW10eXBlIjoiTSIsIml0ZW1kZXNjIjoivNLNpcfpv/ajqNOmsPy6rLi4xLihosXkxbyhosXkxby4uMS4tcijqSIsIml0ZW1sZW5ndGgiOjEwLCJvbmx5X2ZpZWxkIjoiMCIsImxheWVyIjoiMCIsIml0ZW1pZCI6IkE3OUFFIiwiZXhwbGFpbiI6IrzSzaWzydSx0NXD+6GiudjPtaGiuaTX97WlzruhotawzvGhotGnwPoiLCJkZWNpbWFsIjowLCJsZWFmX29ubHkiOiIwIiwibXVzdCI6IjEiLCJkaXNwbGF5bmFtZSI6IiJ9LHsiZmlsZV9saXN0IjpudWxsfV1dfSwiQUFNIjp7InJlY29yZCI6Im5vIiwiZGF0YWxpc3QiOltbeyJjb2Rlc2V0aWQiOiIwIiwiaXRlbXR5cGUiOiJBIiwiaXRlbWRlc2MiOiLLtsq/sc/StdGn0KO78rWlzrsiLCJpdGVtbGVuZ3RoIjoxMDAsIm9ubHlfZmllbGQiOiIwIiwibGF5ZXIiOiIwIiwiaXRlbWlkIjoiQUFNQUEiLCJleHBsYWluIjoiyOfDu9PQo6zM7tC0zt4iLCJkZWNpbWFsIjowLCJsZWFmX29ubHkiOiIwIiwibXVzdCI6IjEiLCJkaXNwbGF5bmFtZSI6IiJ9LHsiY29kZXNldGlkIjoiMCIsIml0ZW10eXBlIjoiRCIsIml0ZW1kZXNjIjoiy7bKv8bwyrzKsbzkIiwiaXRlbWxlbmd0aCI6MTAsIm9ubHlfZmllbGQiOiIwIiwibGF5ZXIiOiIwIiwiZm9ybWF0IjoieXl5eS1NTS1kZCIsIml0ZW1pZCI6IkFBTUFCIiwiZXhwbGFpbiI6IiIsImRlY2ltYWwiOjAsImxlYWZfb25seSI6IjAiLCJtdXN0IjoiMSIsImRpc3BsYXluYW1lIjoiIn0seyJjb2Rlc2V0aWQiOiIwIiwiaXRlbXR5cGUiOiJEIiwiaXRlbWRlc2MiOiLLtsq/veHK+MqxvOQiLCJpdGVtbGVuZ3RoIjoxMCwib25seV9maWVsZCI6IjAiLCJsYXllciI6IjAiLCJmb3JtYXQiOiJ5eXl5LU1NLWRkIiwiaXRlbWlkIjoiQUFNQUMiLCJleHBsYWluIjoiIiwiZGVjaW1hbCI6MCwibGVhZl9vbmx5IjoiMCIsIm11c3QiOiIxIiwiZGlzcGxheW5hbWUiOiIifSx7ImNvZGVzZXRpZCI6Ik1UIiwiaXRlbXR5cGUiOiJBIiwiaXRlbWRlc2MiOiLLtsq/yty9zNP9wODQzSIsIml0ZW1sZW5ndGgiOjEsIm9ubHlfZmllbGQiOiIwIiwibGF5ZXIiOiIxIiwiaXRlbWlkIjoiQUFNQUQiLCJleHBsYWluIjoiIiwiZGVjaW1hbCI6MCwibGVhZl9vbmx5IjoiMCIsIm11c3QiOiIxIiwiZGlzcGxheW5hbWUiOiIifSx7ImNvZGVzZXRpZCI6Ik1TIiwiaXRlbXR5cGUiOiJBIiwiaXRlbWRlc2MiOiLLtsq/0ae/xiIsIml0ZW1sZW5ndGgiOjEsIm9ubHlfZmllbGQiOiIwIiwibGF5ZXIiOiIxIiwiaXRlbWlkIjoiQUFNQUUiLCJleHBsYWluIjoiIiwiZGVjaW1hbCI6MCwibGVhZl9vbmx5IjoiMCIsIm11c3QiOiIwIiwiZGlzcGxheW5hbWUiOiIifSx7ImNvZGVzZXRpZCI6IjAiLCJpdGVtdHlwZSI6IkEiLCJpdGVtZGVzYyI6Isu2yr/XqNK1w/uzxiIsIml0ZW1sZW5ndGgiOjEwMCwib25seV9maWVsZCI6IjAiLCJsYXllciI6IjAiLCJpdGVtaWQiOiJBQU1BRiIsImV4cGxhaW4iOiIiLCJkZWNpbWFsIjowLCJsZWFmX29ubHkiOiIwIiwibXVzdCI6IjEiLCJkaXNwbGF5bmFtZSI6IiJ9LHsiY29kZXNldGlkIjoiMCIsIml0ZW10eXBlIjoiQSIsIml0ZW1kZXNjIjoiy7bKv7W8yqYiLCJpdGVtbGVuZ3RoIjo1MCwib25seV9maWVsZCI6IjAiLCJsYXllciI6IjAiLCJpdGVtaWQiOiJBQU1BSCIsImV4cGxhaW4iOiIiLCJkZWNpbWFsIjowLCJsZWFmX29ubHkiOiIwIiwibXVzdCI6IjEiLCJkaXNwbGF5bmFtZSI6IiJ9LHsiY29kZXNldGlkIjoiMCIsIml0ZW10eXBlIjoiTiIsIml0ZW1kZXNjIjoiy7bKv9Gn1sYiLCJpdGVtbGVuZ3RoIjoxLCJvbmx5X2ZpZWxkIjoiMCIsImxheWVyIjoiMCIsIml0ZW1pZCI6IkFBTUFHIiwiZXhwbGFpbiI6IiIsImRlY2ltYWwiOjEsImxlYWZfb25seSI6IjAiLCJtdXN0IjoiMSIsImRpc3BsYXluYW1lIjoiIn0seyJmaWxlX2xpc3QiOm51bGx9XV19LCJBMDEiOnsicmVjb3JkIjoieWVzIiwiZGF0YWxpc3QiOltbe30seyJjb2Rlc2V0aWQiOiIwIiwiaXRlbXR5cGUiOiJBIiwiaXRlbWRlc2MiOiLQ1cP7IiwiaXRlbWxlbmd0aCI6NDAsIm9ubHlfZmllbGQiOiIwIiwibGF5ZXIiOiIwIiwidmFsdWUiOiLA7r2osqgiLCJpdGVtaWQiOiJBMDEwMSIsImV4cGxhaW4iOiIiLCJkZWNpbWFsIjowLCJsZWFmX29ubHkiOiIwIiwibXVzdCI6IjEiLCJkaXNwbGF5bmFtZSI6IiJ9LHsiY29kZXNldGlkIjoiQVgiLCJpdGVtdHlwZSI6IkEiLCJpdGVtZGVzYyI6ItDUsfAiLCJpdGVtbGVuZ3RoIjoxLCJvbmx5X2ZpZWxkIjoiMCIsImxheWVyIjoiMSIsIml0ZW1pZCI6IkEwMTA3IiwiZGVjaW1hbCI6MCwibXVzdCI6IjEiLCJjb2RlaXRlbWlkIjoiMSIsInZhbHVlIjoixNAiLCJmdWxsdmFsdWUiOiJbJzEnXSIsImV4cGxhaW4iOiIiLCJsZWFmX29ubHkiOiIwIiwiZGlzcGxheW5hbWUiOiIifSx7ImNvZGVzZXRpZCI6IkFDIiwiaXRlbXR5cGUiOiJBIiwiaXRlbWRlc2MiOiLT0NCn1qS8/sDgsfAiLCJpdGVtbGVuZ3RoIjoxLCJvbmx5X2ZpZWxkIjoiMCIsImxheWVyIjoiMSIsInZhbHVlIjoiIiwiaXRlbWlkIjoiQTAxODciLCJleHBsYWluIjoiIiwiZGVjaW1hbCI6MCwibGVhZl9vbmx5IjoiMCIsIm11c3QiOiIwIiwiZGlzcGxheW5hbWUiOiIifSx7ImNvZGVzZXRpZCI6IjAiLCJpdGVtdHlwZSI6IkEiLCJpdGVtZGVzYyI6ItakvP66xcLrIiwiaXRlbWxlbmd0aCI6MTgsIm9ubHlfZmllbGQiOiIwIiwibGF5ZXIiOiIwIiwidmFsdWUiOiIxMTAyMjM3OTA4MTM2OTciLCJpdGVtaWQiOiJBMDE3NyIsImV4cGxhaW4iOiIiLCJkZWNpbWFsIjowLCJsZWFmX29ubHkiOiIwIiwibXVzdCI6IjEiLCJkaXNwbGF5bmFtZSI6IiJ9LHsiY29kZXNldGlkIjoiMCIsIml0ZW10eXBlIjoiRCIsIml0ZW1kZXNjIjois/bJ+sjVxtoiLCJpdGVtbGVuZ3RoIjoxMCwib25seV9maWVsZCI6IjAiLCJsYXllciI6IjAiLCJmb3JtYXQiOiJ5eXl5LU1NLWRkIiwiaXRlbWlkIjoiQTAxMTEiLCJkZWNpbWFsIjowLCJtdXN0IjoiMSIsInZhbHVlIjoiMTk3OS0wOC0xMyIsImV4cGxhaW4iOiIiLCJsZWFmX29ubHkiOiIwIiwiZGlzcGxheW5hbWUiOiIifSx7ImNvZGVzZXRpZCI6IkFFIiwiaXRlbXR5cGUiOiJBIiwiaXRlbWRlc2MiOiLD8dflIiwiaXRlbWxlbmd0aCI6Miwib25seV9maWVsZCI6IjAiLCJsYXllciI6IjEiLCJ2YWx1ZSI6IiIsIml0ZW1pZCI6IkEwMTIxIiwiZXhwbGFpbiI6IiIsImRlY2ltYWwiOjAsImxlYWZfb25seSI6IjAiLCJtdXN0IjoiMSIsImRpc3BsYXluYW1lIjoiIn0seyJjb2Rlc2V0aWQiOiJBNCIsIml0ZW10eXBlIjoiQSIsIml0ZW1kZXNjIjoivK654SIsIml0ZW1sZW5ndGgiOjQsIm9ubHlfZmllbGQiOiIwIiwibGF5ZXIiOiIyIiwidmFsdWUiOiIiLCJpdGVtaWQiOiJBMDFCUCIsImV4cGxhaW4iOiIiLCJkZWNpbWFsIjowLCJsZWFmX29ubHkiOiIxIiwibXVzdCI6IjEiLCJkaXNwbGF5bmFtZSI6IryuueEifSx7ImNvZGVzZXRpZCI6IkFUIiwiaXRlbXR5cGUiOiJBIiwiaXRlbWRlc2MiOiLV/tbOw+bDsiIsIml0ZW1sZW5ndGgiOjIsIm9ubHlfZmllbGQiOiIwIiwibGF5ZXIiOiIxIiwidmFsdWUiOiIiLCJpdGVtaWQiOiJDMDEwRSIsImV4cGxhaW4iOiJcclxuIiwiZGVjaW1hbCI6MCwibGVhZl9vbmx5IjoiMCIsIm11c3QiOiIxIiwiZGlzcGxheW5hbWUiOiIifSx7ImNvZGVzZXRpZCI6IkJHIiwiaXRlbXR5cGUiOiJBIiwiaXRlbWRlc2MiOiK76dL217S/9iIsIml0ZW1sZW5ndGgiOjEsIm9ubHlfZmllbGQiOiIwIiwibGF5ZXIiOiIxIiwidmFsdWUiOiIiLCJpdGVtaWQiOiJBMDEyNyIsImV4cGxhaW4iOiIiLCJkZWNpbWFsIjowLCJsZWFmX29ubHkiOiIwIiwibXVzdCI6IjEiLCJkaXNwbGF5bmFtZSI6IiJ9LHsiY29kZXNldGlkIjoiTU4iLCJpdGVtdHlwZSI6IkEiLCJpdGVtZGVzYyI6ItGnwPoiLCJpdGVtbGVuZ3RoIjoxLCJvbmx5X2ZpZWxkIjoiMCIsImxheWVyIjoiMSIsInZhbHVlIjoiIiwiaXRlbWlkIjoiQTAxQkgiLCJleHBsYWluIjoiIiwiZGVjaW1hbCI6MCwibGVhZl9vbmx5IjoiMCIsIm11c3QiOiIxIiwiZGlzcGxheW5hbWUiOiLRp8D6In0seyJjb2Rlc2V0aWQiOiJNTyIsIml0ZW10eXBlIjoiQSIsIml0ZW1kZXNjIjoi0afOuyIsIml0ZW1sZW5ndGgiOjEsIm9ubHlfZmllbGQiOiIwIiwibGF5ZXIiOiIxIiwidmFsdWUiOiIiLCJpdGVtaWQiOiJBMDFCSSIsImV4cGxhaW4iOiIiLCJkZWNpbWFsIjowLCJsZWFmX29ubHkiOiIwIiwibXVzdCI6IjEiLCJkaXNwbGF5bmFtZSI6ItGnzrsifSx7ImNvZGVzZXRpZCI6IjAiLCJpdGVtdHlwZSI6IkEiLCJpdGVtZGVzYyI6ItLGtq+157uwIiwiaXRlbWxlbmd0aCI6NTAsIm9ubHlfZmllbGQiOiIwIiwibGF5ZXIiOiIwIiwidmFsdWUiOiIiLCJpdGVtaWQiOiJBMDE0OCIsImV4cGxhaW4iOiIiLCJkZWNpbWFsIjowLCJsZWFmX29ubHkiOiIwIiwibXVzdCI6IjEiLCJkaXNwbGF5bmFtZSI6IiJ9LHsiY29kZXNldGlkIjoiMCIsIml0ZW10eXBlIjoiQSIsIml0ZW1kZXNjIjoiwarPtbXY1rciLCJpdGVtbGVuZ3RoIjo1MCwib25seV9maWVsZCI6IjAiLCJsYXllciI6IjAiLCJ2YWx1ZSI6IiIsIml0ZW1pZCI6IkEwMTE5IiwiZXhwbGFpbiI6IiIsImRlY2ltYWwiOjAsImxlYWZfb25seSI6IjAiLCJtdXN0IjoiMSIsImRpc3BsYXluYW1lIjoiIn0seyJjb2Rlc2V0aWQiOiIwIiwiaXRlbXR5cGUiOiJBIiwiaXRlbWRlc2MiOiK159fT08rP5CIsIml0ZW1sZW5ndGgiOjQwLCJvbmx5X2ZpZWxkIjoiMCIsImxheWVyIjoiMCIsInZhbHVlIjoiMTM2MzE2M0BxcS5jb20iLCJpdGVtaWQiOiJBMDE0NiIsImV4cGxhaW4iOiIiLCJkZWNpbWFsIjowLCJsZWFmX29ubHkiOiIwIiwibXVzdCI6IjEiLCJkaXNwbGF5bmFtZSI6IiJ9LHsiY29kZXNldGlkIjoiMCIsIml0ZW10eXBlIjoiQSIsIml0ZW1kZXNjIjoivMjN+bKhyrciLCJpdGVtbGVuZ3RoIjoyMDAsIm9ubHlfZmllbGQiOiIwIiwibGF5ZXIiOiIwIiwidmFsdWUiOiIiLCJpdGVtaWQiOiJBMDFCSyIsImV4cGxhaW4iOiIiLCJkZWNpbWFsIjowLCJsZWFmX29ubHkiOiIwIiwibXVzdCI6IjEiLCJkaXNwbGF5bmFtZSI6IrzIzfmyocq3In0seyJjb2Rlc2V0aWQiOiIwIiwiaXRlbXR5cGUiOiJBIiwiaXRlbWRlc2MiOiK1tbC4y/nU2rXYIiwiaXRlbWxlbmd0aCI6MTAwLCJvbmx5X2ZpZWxkIjoiMCIsImxheWVyIjoiMCIsInZhbHVlIjoiIiwiaXRlbWlkIjoiQTAxQkwiLCJleHBsYWluIjoiIiwiZGVjaW1hbCI6MCwibGVhZl9vbmx5IjoiMCIsIm11c3QiOiIxIiwiZGlzcGxheW5hbWUiOiK1tbC4y/nU2rXYIn0seyJjb2Rlc2V0aWQiOiIwIiwiaXRlbXR5cGUiOiJBIiwiaXRlbWRlc2MiOiLP1rTTysLXqNK1u/LR0L6/t73P8iIsIml0ZW1sZW5ndGgiOjEwMCwib25seV9maWVsZCI6IjAiLCJsYXllciI6IjAiLCJ2YWx1ZSI6IiIsIml0ZW1pZCI6IkEwMUNTIiwiZXhwbGFpbiI6IiIsImRlY2ltYWwiOjAsImxlYWZfb25seSI6IjAiLCJtdXN0IjoiMSIsImRpc3BsYXluYW1lIjoiz9a008rC16jStbvy0dC+v7e9z/IifSx7ImNvZGVzZXRpZCI6IjAiLCJpdGVtdHlwZSI6IkEiLCJpdGVtZGVzYyI6ItXQxrjQxc+iwLTUtCIsIml0ZW1sZW5ndGgiOjEwMCwib25seV9maWVsZCI6IjAiLCJsYXllciI6IjAiLCJ2YWx1ZSI6IiIsIml0ZW1pZCI6IkEwMUNZIiwiZXhwbGFpbiI6IiIsImRlY2ltYWwiOjAsImxlYWZfb25seSI6IjAiLCJtdXN0IjoiMCIsImRpc3BsYXluYW1lIjoiIn0seyJjb2Rlc2V0aWQiOiIwIiwiaXRlbXR5cGUiOiJBIiwiaXRlbWRlc2MiOiLTotPvy67GvSIsIml0ZW1sZW5ndGgiOjUwLCJvbmx5X2ZpZWxkIjoiMCIsImxheWVyIjoiMCIsInZhbHVlIjoiIiwiaXRlbWlkIjoiQTAxREEiLCJleHBsYWluIjoiwP3I56O6Q0VUNqOvNDgwIiwiZGVjaW1hbCI6MCwibGVhZl9vbmx5IjoiMCIsIm11c3QiOiIxIiwiZGlzcGxheW5hbWUiOiLTotPvy67GvSJ9LHsiY29kZXNldGlkIjoiMCIsIml0ZW10eXBlIjoiQSIsIml0ZW1kZXNjIjoi1rCzxiIsIml0ZW1sZW5ndGgiOjEwMCwib25seV9maWVsZCI6IjAiLCJsYXllciI6IjAiLCJ2YWx1ZSI6IiIsIml0ZW1pZCI6IkEwMUREIiwiZXhwbGFpbiI6IiIsImRlY2ltYWwiOjAsImxlYWZfb25seSI6IjAiLCJtdXN0IjoiMSIsImRpc3BsYXluYW1lIjoi1rCzxiJ9LHsiY29kZXNldGlkIjoiMCIsIml0ZW10eXBlIjoiQSIsIml0ZW1kZXNjIjoisc/StdS60KMiLCJpdGVtbGVuZ3RoIjoxMDAsIm9ubHlfZmllbGQiOiIwIiwibGF5ZXIiOiIwIiwidmFsdWUiOiIiLCJpdGVtaWQiOiJBMDFERSIsImV4cGxhaW4iOiIiLCJkZWNpbWFsIjowLCJsZWFmX29ubHkiOiIwIiwibXVzdCI6IjEiLCJkaXNwbGF5bmFtZSI6IrHP0rXUutCjIn0seyJjb2Rlc2V0aWQiOiIwIiwiaXRlbXR5cGUiOiJBIiwiaXRlbWRlc2MiOiLL+dGn16jStSIsIml0ZW1sZW5ndGgiOjEwMCwib25seV9maWVsZCI6IjAiLCJsYXllciI6IjAiLCJ2YWx1ZSI6IiIsIml0ZW1pZCI6IkEwMURGIiwiZXhwbGFpbiI6IiIsImRlY2ltYWwiOjAsImxlYWZfb25seSI6IjAiLCJtdXN0IjoiMSIsImRpc3BsYXluYW1lIjoiy/nRp9eo0rUifSx7ImNvZGVzZXRpZCI6IjAiLCJpdGVtdHlwZSI6IkEiLCJpdGVtZGVzYyI6IrHP0rXKsbzkIiwiaXRlbWxlbmd0aCI6MTAwLCJvbmx5X2ZpZWxkIjoiMCIsImxheWVyIjoiMCIsInZhbHVlIjoiIiwiaXRlbWlkIjoiQTAxREciLCJleHBsYWluIjoiwP3I56O6MjAyMcTqNtTCIiwiZGVjaW1hbCI6MCwibGVhZl9vbmx5IjoiMCIsIm11c3QiOiIxIiwiZGlzcGxheW5hbQ0KMjAwMA0KZSI6IrHP0rXKsbzkIn0seyJjb2Rlc2V0aWQiOiJOUSIsIml0ZW10eXBlIjoiQSIsIml0ZW1kZXNjIjoixeDR+Le9yr0iLCJpdGVtbGVuZ3RoIjoxLCJvbmx5X2ZpZWxkIjoiMCIsImxheWVyIjoiMSIsInZhbHVlIjoiIiwiaXRlbWlkIjoiQTAxREgiLCJleHBsYWluIjoiIiwiZGVjaW1hbCI6MCwibGVhZl9vbmx5IjoiMCIsIm11c3QiOiIxIiwiZGlzcGxheW5hbWUiOiLF4NH4t73KvSJ9LHsiZmlsZV9saXN0IjpudWxsfV1dfSwiQUJLIjp7InJlY29yZCI6Im5vIiwiZGF0YWxpc3QiOltbeyJjb2Rlc2V0aWQiOiIwIiwiaXRlbXR5cGUiOiJBIiwiaXRlbWRlc2MiOiKxz9K10afQoyIsIml0ZW1sZW5ndGgiOjEwMCwib25seV9maWVsZCI6IjAiLCJsYXllciI6IjAiLCJpdGVtaWQiOiJBQktBQSIsImV4cGxhaW4iOiIiLCJkZWNpbWFsIjowLCJsZWFmX29ubHkiOiIwIiwibXVzdCI6IjEiLCJkaXNwbGF5bmFtZSI6IiJ9LHsiY29kZXNldGlkIjoiMCIsIml0ZW10eXBlIjoiRCIsIml0ZW1kZXNjIjoiuN/W0MbwyrzKsbzkIiwiaXRlbWxlbmd0aCI6MTAsIm9ubHlfZmllbGQiOiIwIiwibGF5ZXIiOiIwIiwiZm9ybWF0IjoieXl5eS1NTS1kZCIsIml0ZW1pZCI6IkFCS0FCIiwiZXhwbGFpbiI6IiIsImRlY2ltYWwiOjAsImxlYWZfb25seSI6IjAiLCJtdXN0IjoiMCIsImRpc3BsYXluYW1lIjoiIn0seyJjb2Rlc2V0aWQiOiIwIiwiaXRlbXR5cGUiOiJEIiwiaXRlbWRlc2MiOiK439bQveHK+MqxvOQiLCJpdGVtbGVuZ3RoIjoxMCwib25seV9maWVsZCI6IjAiLCJsYXllciI6IjAiLCJmb3JtYXQiOiJ5eXl5LU1NLWRkIiwiaXRlbWlkIjoiQUJLQUMiLCJleHBsYWluIjoiIiwiZGVjaW1hbCI6MCwibGVhZl9vbmx5IjoiMCIsIm11c3QiOiIwIiwiZGlzcGxheW5hbWUiOiIifSx7ImZpbGVfbGlzdCI6bnVsbH1dXX0sIkFBTCI6eyJyZWNvcmQiOiJubyIsImRhdGFsaXN0IjpbW3siY29kZXNldGlkIjoiMCIsIml0ZW10eXBlIjoiQSIsIml0ZW1kZXNjIjoisc/StdGn0KO78rWlzrsiLCJpdGVtbGVuZ3RoIjoxMDAsIm9ubHlfZmllbGQiOiIwIiwibGF5ZXIiOiIwIiwiaXRlbWlkIjoiQUFMQUEiLCJleHBsYWluIjoiIiwiZGVjaW1hbCI6MCwibGVhZl9vbmx5IjoiMCIsIm11c3QiOiIxIiwiZGlzcGxheW5hbWUiOiIifSx7ImNvZGVzZXRpZCI6IjAiLCJpdGVtdHlwZSI6IkQiLCJpdGVtZGVzYyI6IrG+v8bG8Mq8yrG85CIsIml0ZW1sZW5ndGgiOjEwLCJvbmx5X2ZpZWxkIjoiMCIsImxheWVyIjoiMCIsImZvcm1hdCI6Inl5eXktTU0tZGQiLCJpdGVtaWQiOiJBQUxBQiIsImV4cGxhaW4iOiIiLCJkZWNpbWFsIjowLCJsZWFmX29ubHkiOiIwIiwibXVzdCI6IjEiLCJkaXNwbGF5bmFtZSI6IiJ9LHsiY29kZXNldGlkIjoiMCIsIml0ZW10eXBlIjoiRCIsIml0ZW1kZXNjIjoisb6/xr3hyvjKsbzkIiwiaXRlbWxlbmd0aCI6MTAsIm9ubHlfZmllbGQiOiIwIiwibGF5ZXIiOiIwIiwiZm9ybWF0IjoieXl5eS1NTS1kZCIsIml0ZW1pZCI6IkFBTEFDIiwiZXhwbGFpbiI6IiIsImRlY2ltYWwiOjAsImxlYWZfb25seSI6IjAiLCJtdXN0IjoiMSIsImRpc3BsYXluYW1lIjoiIn0seyJjb2Rlc2V0aWQiOiJNUiIsIml0ZW10eXBlIjoiQSIsIml0ZW1kZXNjIjoiyty9zNP9wODQzSIsIml0ZW1sZW5ndGgiOjEsIm9ubHlfZmllbGQiOiIwIiwibGF5ZXIiOiIxIiwiaXRlbWlkIjoiQUFMQUQiLCJleHBsYWluIjoiIiwiZGVjaW1hbCI6MCwibGVhZl9vbmx5IjoiMCIsIm11c3QiOiIxIiwiZGlzcGxheW5hbWUiOiIifSx7ImNvZGVzZXRpZCI6Ik1TIiwiaXRlbXR5cGUiOiJBIiwiaXRlbWRlc2MiOiLRp7/GIiwiaXRlbWxlbmd0aCI6MSwib25seV9maWVsZCI6IjAiLCJsYXllciI6IjEiLCJpdGVtaWQiOiJBQUxBRSIsImV4cGxhaW4iOiIiLCJkZWNpbWFsIjowLCJsZWFmX29ubHkiOiIwIiwibXVzdCI6IjEiLCJkaXNwbGF5bmFtZSI6IiJ9LHsiY29kZXNldGlkIjoiMCIsIml0ZW10eXBlIjoiQSIsIml0ZW1kZXNjIjoi16jStcP7s8YiLCJpdGVtbGVuZ3RoIjoxMDAsIm9ubHlfZmllbGQiOiIwIiwibGF5ZXIiOiIwIiwiaXRlbWlkIjoiQUFMQUYiLCJleHBsYWluIjoiIiwiZGVjaW1hbCI6MCwibGVhZl9vbmx5IjoiMCIsIm11c3QiOiIxIiwiZGlzcGxheW5hbWUiOiIifSx7ImNvZGVzZXRpZCI6IjAiLCJpdGVtdHlwZSI6Ik4iLCJpdGVtZGVzYyI6IrG+v8bRp9bGIiwiaXRlbWxlbmd0aCI6MSwib25seV9maWVsZCI6IjAiLCJsYXllciI6IjAiLCJpdGVtaWQiOiJBQUxBRyIsImV4cGxhaW4iOiIiLCJkZWNpbWFsIjoxLCJsZWFmX29ubHkiOiIwIiwibXVzdCI6IjEiLCJkaXNwbGF5bmFtZSI6IiJ9LHsiZmlsZV9saXN0IjpudWxsfV1dfSwiQUFOIjp7InJlY29yZCI6Im5vIiwiZGF0YWxpc3QiOltbeyJjb2Rlc2V0aWQiOiIwIiwiaXRlbXR5cGUiOiJBIiwiaXRlbWRlc2MiOiKyqcq/sc/StdGn0KO78rWlzrsiLCJpdGVtbGVuZ3RoIjoxMDAsIm9ubHlfZmllbGQiOiIwIiwibGF5ZXIiOiIwIiwiaXRlbWlkIjoiQUFOQUEiLCJleHBsYWluIjoiyOfDu9PQo6zM7tC0zt4iLCJkZWNpbWFsIjowLCJsZWFmX29ubHkiOiIwIiwibXVzdCI6IjEiLCJkaXNwbGF5bmFtZSI6IiJ9LHsiY29kZXNldGlkIjoiMCIsIml0ZW10eXBlIjoiRCIsIml0ZW1kZXNjIjoisqnKv8bwyrzKsbzkIiwiaXRlbWxlbmd0aCI6MTAsIm9ubHlfZmllbGQiOiIwIiwibGF5ZXIiOiIwIiwiZm9ybWF0IjoieXl5eS1NTS1kZCIsIml0ZW1pZCI6IkFBTkFCIiwiZXhwbGFpbiI6IiIsImRlY2ltYWwiOjAsImxlYWZfb25seSI6IjAiLCJtdXN0IjoiMCIsImRpc3BsYXluYW1lIjoiIn0seyJjb2Rlc2V0aWQiOiIwIiwiaXRlbXR5cGUiOiJEIiwiaXRlbWRlc2MiOiKyqcq/veHK+MqxvOQiLCJpdGVtbGVuZ3RoIjoxMCwib25seV9maWVsZCI6IjAiLCJsYXllciI6IjAiLCJmb3JtYXQiOiJ5eXl5LU1NLWRkIiwiaXRlbWlkIjoiQUFOQUMiLCJleHBsYWluIjoiIiwiZGVjaW1hbCI6MCwibGVhZl9vbmx5IjoiMCIsIm11c3QiOiIwIiwiZGlzcGxheW5hbWUiOiIifSx7ImNvZGVzZXRpZCI6Ik1UIiwiaXRlbXR5cGUiOiJBIiwiaXRlbWRlc2MiOiKyqcq/yty9zNP9wODQzSIsIml0ZW1sZW5ndGgiOjEsIm9ubHlfZmllbGQiOiIwIiwibGF5ZXIiOiIxIiwiaXRlbWlkIjoiQUFOQUQiLCJleHBsYWluIjoiIiwiZGVjaW1hbCI6MCwibGVhZl9vbmx5IjoiMCIsIm11c3QiOiIwIiwiZGlzcGxheW5hbWUiOiIifSx7ImNvZGVzZXRpZCI6Ik1TIiwiaXRlbXR5cGUiOiJBIiwiaXRlbWRlc2MiOiKyqcq/0ae/xiIsIml0ZW1sZW5ndGgiOjEsIm9ubHlfZmllbGQiOiIwIiwibGF5ZXIiOiIxIiwiaXRlbWlkIjoiQUFOQUUiLCJleHBsYWluIjoiIiwiZGVjaW1hbCI6MCwibGVhZl9vbmx5IjoiMCIsIm11c3QiOiIwIiwiZGlzcGxheW5hbWUiOiIifSx7ImNvZGVzZXRpZCI6IjAiLCJpdGVtdHlwZSI6IkEiLCJpdGVtZGVzYyI6IrKpyr+1vMqmIiwiaXRlbWxlbmd0aCI6NTAsIm9ubHlfZmllbGQiOiIwIiwibGF5ZXIiOiIwIiwiaXRlbWlkIjoiQUFOQUgiLCJleHBsYWluIjoiIiwiZGVjaW1hbCI6MCwibGVhZl9vbmx5IjoiMCIsIm11c3QiOiIwIiwiZGlzcGxheW5hbWUiOiIifSx7ImNvZGVzZXRpZCI6IjAiLCJpdGVtdHlwZSI6IkEiLCJpdGVtZGVzYyI6IrKpyr/XqNK1w/uzxiIsIml0ZW1sZW5ndGgiOjEwMCwib25seV9maWVsZCI6IjAiLCJsYXllciI6IjAiLCJpdGVtaWQiOiJBQU5BRiIsImV4cGxhaW4iOiIiLCJkZWNpbWFsIjowLCJsZWFmX29ubHkiOiIwIiwibXVzdCI6IjAiLCJkaXNwbGF5bmFtZSI6IiJ9LHsiY29kZXNldGlkIjoiMCIsIml0ZW10eXBlIjoiTiIsIml0ZW1kZXNjIjoisqnKv9Gn1sYiLCJpdGVtbGVuZ3RoIjoxLCJvbmx5X2ZpZWxkIjoiMCIsImxheWVyIjoiMCIsIml0ZW1pZCI6IkFBTkFHIiwiZXhwbGFpbiI6IiIsImRlY2ltYWwiOjEsImxlYWZfb25seSI6IjAiLCJtdXN0IjoiMCIsImRpc3BsYXluYW1lIjoiIn0seyJmaWxlX2xpc3QiOm51bGx9XV19LCJBQlAiOnsicmVjb3JkIjoibm8iLCJkYXRhbGlzdCI6W1t7ImNvZGVzZXRpZCI6IjAiLCJpdGVtdHlwZSI6Ik0iLCJpdGVtZGVzYyI6ItfKuPHWpMrpIiwiaXRlbWxlbmd0aCI6MTAsIm9ubHlfZmllbGQiOiIwIiwibGF5ZXIiOiIwIiwiaXRlbWlkIjoiQUJQQUEiLCJleHBsYWluIjoiIiwiZGVjaW1hbCI6MCwibGVhZl9vbmx5IjoiMCIsIm11c3QiOiIwIiwiZGlzcGxheW5hbWUiOiIifSx7ImZpbGVfbGlzdCI6bnVsbH1dXX0sIkFCTyI6eyJyZWNvcmQiOiJubyIsImRhdGFsaXN0IjpbW3siY29kZXNldGlkIjoiMCIsIml0ZW10eXBlIjoiTSIsIml0ZW1kZXNjIjoixuTL+8u1w/ciLCJpdGVtbGVuZ3RoIjoxMCwib25seV9maWVsZCI6IjAiLCJsYXllciI6IjAiLCJpdGVtaWQiOiJBQk9BQSIsImV4cGxhaW4iOiLI9LGow/ux7cv5wdDP7sS/srvE3Le007O1xKOs06bGuNXf0OvU2rTL16LD96GjIiwiZGVjaW1hbCI6MCwibGVhZl9vbmx5IjoiMCIsIm11c3QiOiIxIiwiZGlzcGxheW5hbWUiOiLG5Mv7y7XD9yJ9LHsiZmlsZV9saXN0IjpudWxsfV1dfSwiQUFLIjp7InJlY29yZCI6Im5vIiwiZGF0YWxpc3QiOltbeyJjb2Rlc2V0aWQiOiJNUSIsIml0ZW10eXBlIjoiQSIsIml0ZW1kZXNjIjoivMbL47v61qTK6bXIvLYiLCJpdGVtbGVuZ3RoIjoxLCJvbmx5X2ZpZWxkIjoiMCIsImxheWVyIjoiMSIsIml0ZW1pZCI6IkFBS0FBIiwiZXhwbGFpbiI6IiIsImRlY2ltYWwiOjAsImxlYWZfb25seSI6IjAiLCJtdXN0IjoiMCIsImRpc3BsYXluYW1lIjoiIn0seyJjb2Rlc2V0aWQiOiIwIiwiaXRlbXR5cGUiOiJBIiwiaXRlbWRlc2MiOiK8xsvju/rWpMrpt9bK/SIsIml0ZW1sZW5ndGgiOjEwMCwib25seV9maWVsZCI6IjAiLCJsYXllciI6IjAiLCJpdGVtaWQiOiJBQUtBQiIsImV4cGxhaW4iOiIiLCJkZWNpbWFsIjowLCJsZWFmX29ubHkiOiIwIiwibXVzdCI6IjAiLCJkaXNwbGF5bmFtZSI6IiJ9LHsiZmlsZV9saXN0IjpudWxsfV1dfSwiQUJOIjp7InJlY29yZCI6Im5vIiwiZGF0YWxpc3QiOltbeyJjb2Rlc2V0aWQiOiIwIiwiaXRlbXR5cGUiOiJNIiwiaXRlbWRlc2MiOiLW99Kq0rW8qLPJufsiLCJpdGVtbGVuZ3RoIjoxMCwib25seV9maWVsZCI6IjAiLCJsYXllciI6IjAiLCJpdGVtaWQiOiJBQk5BQSIsImV4cGxhaW4iOiIiLCJkZWNpbWFsIjowLCJsZWFmX29ubHkiOiIwIiwibXVzdCI6IjEiLCJkaXNwbGF5bmFtZSI6IiJ9LHsiZmlsZV9saXN0IjpudWxsfV1dfSwiQUJNIjp7InJlY29yZCI6Im5vIiwiZGF0YWxpc3QiOltbeyJjb2Rlc2V0aWQiOiIwIiwiaXRlbXR5cGUiOiJNIiwiaXRlbWRlc2MiOiKxvsjLvLDF5MW80+vO0tCjvczWsLmkyP20+sfXyvS52M+1IiwiaXRlbWxlbmd0aCI6MTAsIm9ubHlfZmllbGQiOiIwIiwibGF5ZXIiOiIwIiwiaXRlbWlkIjoiQUJNQUciLCJleHBsYWluIjoix9fK9NDVw/uhornYz7Whormk1/eyv8PFvLDIztawo7vI58O709DH68zu0LTO3qGjIiwiZGVjaW1hbCI6MCwibGVhZl9vbmx5IjoiMCIsIm11c3QiOiIxIiwiZGlzcGxheW5hbWUiOiIifSx7ImZpbGVfbGlzdCI6bnVsbH1dXX19LCJhdHRhY2giOiIxIiwiYXR0YWNoQ29kZVNldCI6W3siaGFzRmlsZSI6dHJ1ZSwiaXRlbURlc2MiOiLTpsa4ssTBzyIsIm5vdE51bGwiOiIxIiwiaXRlbUlkIjoiMDEifV0sInN1YkZpbGVNYXhTaXplIjoiNTI0Mjg4MC4wIiwiZmllbGRfc2V0X2xpc3QiOlt7ImZpZWxkc2V0ZGVzYyI6Irv5sb7Qxc+iIiwiZmllbGRzZXRpZCI6IkEwMSIsImRlbGV0ZVJlY29yZCI6IiIsImV4cGxhaW4iOiIiLCJmaWxlX2ZsYWciOiIwIiwibXVzdCI6IjEiLCJkaXNwbGF5bmFtZSI6Irv5sb7Qxc+iIn0seyJmaWVsZHNldGRlc2MiOiK439bQ0afPsL6twPoiLCJmaWVsZHNldGlkIjoiQUJLIiwiZGVsZXRlUmVjb3JkIjoiIiwiZXhwbGFpbiI6IiIsImZpbGVfZmxhZyI6IjAiLCJtdXN0IjoiMSIsImRpc3BsYXluYW1lIjoiuN/W0NGnz7C+rcD6In0seyJmaWVsZHNldGRlc2MiOiKxvr/G0afPsL6twPqjqNXQxrijqSIsImZpZWxkc2V0aWQiOiJBQUwiLCJkZWxldGVSZWNvcmQiOiIiLCJleHBsYWluIjoiIiwiZmlsZV9mbGFnIjoiMCIsIm11c3QiOiIxIiwiZGlzcGxheW5hbWUiOiKxvr/G0afPsL6twPoifSx7ImZpZWxkc2V0ZGVzYyI6Isu2yr/Rp8+wvq3A+qOo1dDGuKOpIiwiZmllbGRzZXRpZCI6IkFBTSIsImRlbGV0ZVJlY29yZCI6IiIsImV4cGxhaW4iOiIiLCJmaWxlX2ZsYWciOiIwIiwibXVzdCI6IjEiLCJkaXNwbGF5bmFtZSI6Isu2yr/Rp8+wvq3A+iJ9LHsiZmllbGRzZXRkZXNjIjoisqnKv9Gnz7C+rcD6o6jV0Ma4o6kiLCJmaWVsZHNldGlkIjoiQUFOIiwiZGVsZXRlUmVjb3JkIjoiIiwiZXhwbGFpbiI6IiIsImZpbGVfZmxhZyI6IjAiLCJtdXN0IjoiMSIsImRpc3BsYXluYW1lIjoisqnKv9Gnz7C+rcD6In0seyJmaWVsZHNldGRlc2MiOiK5pNf3vPLA+iIsImZpZWxkc2V0aWQiOiJBMTkiLCJkZWxldGVSZWNvcmQiOiIiLCJleHBsYWluIjoiIiwiZmlsZV9mbGFnIjoiMCIsIm11c3QiOiIxIiwiZGlzcGxheW5hbWUiOiK5pNf3vq3A+iJ9LHsiZmllbGRzZXRkZXNjIjoivNLNpbPJ1LHQxc+iIiwiZmllbGRzZXRpZCI6IkE3OSIsImRlbGV0ZVJlY29yZCI6IiIsImV4cGxhaW4iOiIiLCJmaWxlX2ZsYWciOiIwIiwibXVzdCI6IjEiLCJkaXNwbGF5bmFtZSI6IrzSzaXH6b/2In0seyJmaWVsZHNldGRlc2MiOiKxvsjLvLCwrsjL0+vO0tCjvczWsLmkyP20+sfXyvS52M+1IiwiZmllbGRzZXRpZCI6IkFCTSIsImRlbGV0ZVJlY29yZCI6IiIsImV4cGxhaW4iOiIiLCJmaWxlX2ZsYWciOiIwIiwibXVzdCI6IjEiLCJkaXNwbGF5bmFtZSI6IrG+yMu8sMXkxbzT687S0KO9zNawuaTI/bT6x9fK9LnYz7UifSx7ImZpZWxkc2V0ZGVzYyI6IrzGy+O7+sTcwaajqNXQxrijqSIsImZpZWxkc2V0aWQiOiJBQUsiLCJkZWxldGVSZWNvcmQiOiIiLCJleHBsYWluIjoiIiwiZmlsZV9mbGFnIjoiMCIsIm11c3QiOiIxIiwiZGlzcGxheW5hbWUiOiK8xsvju/rE3MGmIn0seyJmaWVsZHNldGRlc2MiOiLXytXf1qTK6SIsImZpZWxkc2V0aWQiOiJBQlAiLCJkZWxldGVSZWNvcmQiOiIiLCJleHBsYWluIjoiIiwiZmlsZV9mbGFnIjoiMCIsIm11c3QiOiIxIiwiZGlzcGxheW5hbWUiOiLXyrjx1qTK6SJ9LHsiZmllbGRzZXRkZXNjIjoiu/G9sbPJufsiLCJmaWVsZHNldGlkIjoiQTQ5IiwiZGVsZXRlUmVjb3JkIjoiIiwiZXhwbGFpbiI6IiIsImZpbGVfZmxhZyI6IjAiLCJtdXN0IjoiMSIsImRpc3BsYXluYW1lIjoivbGzzcfpv/YifSx7ImZpZWxkc2V0ZGVzYyI6ItGnyfq5pNf3vq3A+qOo1dDGuKOpIiwiZmllbGRzZXRpZCI6IkFCUSIsImRlbGV0ZVJlY29yZCI6IiIsImV4cGxhaW4iOiIiLCJmaWxlX2ZsYWciOiIwIiwibXVzdCI6IjEiLCJkaXNwbGF5bmFtZSI6ItGnyfq5pNf3vq3A+iJ9LHsiZmllbGRzZXRkZXNjIjoi1vfSqtK1vKizybn7IiwiZmllbGRzZXRpZCI6IkFCTiIsImRlbGV0ZVJlY29yZCI6IiIsImV4cGxhaW4iOiIiLCJmaWxlX2ZsYWciOiIwIiwibXVzdCI6IjEiLCJkaXNwbGF5bmFtZSI6Itb30qrStbyos8m5+yJ9LHsiZmllbGRzZXRkZXNjIjoi06bGuLavu/qjqNXQxrijqSIsImZpZWxkc2V0aWQiOiJBQVAiLCJkZWxldGVSZWNvcmQiOiIiLCJleHBsYWluIjoiIiwiZmlsZV9mbGFnIjoiMCIsIm11c3QiOiIxIiwiZGlzcGxheW5hbWUiOiLTpsa4tq+7+iJ9LHsiZmllbGRzZXRkZXNjIjoisbjXoiIsImZpZWxkc2V0aWQiOiJBQk8iLCJkZWxldGVSZWNvcmQiOiIiLCJleHBsYWluIjoiIiwiZmlsZV9mbGFnIjoiMCIsIm11c3QiOiIxIiwiZGlzcGxheW5hbWUiOiLG5Mv7y7XD9yJ9XSwidXBsb2FkRmlsZUxpc3QiOlt7ImVuY3J5cHRfZmlsZV9uYW1lIjoiSEFVNDdiUXVQQUFUVFAySEpGUEFBVFRQWlpvZ2JQNUNSTnJZd1BBQVRUUDNISkRQQUFUVFBQQUFUVFAzSEpEUEFBVFRQIiwiZmlsZV9pZCI6IjYxS0d6SlF2S2JnUEFBVFRQM0hKRFBBQVRUUCIsImZpbGVOYW1lIjoi06bGuLLEwc8ucG5nIiwicGF0aCI6InNKWWhmVjZ4bWtLQ0tMaEpLMllQQUFUVFAySEpGUEFBVFRQMHhyUEVpM3VtRTJVUjhhU2Y4OElqNmVoR3ZieEpmRVVkR3prS2d5RkhqZ2szUEFBVFRQMkhKQlBBQVRUUFdCTGZ5MndlU0Y2azFwbVB3ZjhWRTZQQUFUVFAySEpGUEFBVFRQQTdCNGJkRUhxbGpjVTB2eVVCZG12SG9wZEhMdGdQQUFUVFAzSEpEUEFBVFRQUEFBVFRQM0hKRFBBQVRUUCIsImZpbGVfbmFtZSI6ItOmxriyxMHPLnBuZyIsImZpbGVfdHlwZSI6InBuZyJ9XSwiZW1haWxfaXRlbSI6ImEwMTQNCjdiDQo2IiwicGhvbmVfaXRlbSI6ImEwMTQ4In0sInNlc3Npb25ITSI6e30sImFwcGx5Q29kZSI6IjAyIiwidHlwZSI6InNlYXJjaCIsImZ1bmN0aW9uSWQiOiJaUDEwMDAwMDAwMDQiLCJjYW5kaWRhdGVfc3RhdHVzIjoiIn0NCjANCg0K`)

	debugCRLF := `POST /abc HTTP/1.1` + "\r\r\nHost: www.baidu.com\r\r\r\n\r\n"
	tests := []struct {
		name     string
		args     args
		wantRsp  func(t *testing.T, rsp []byte)
		wantBody func(t *testing.T, rsp []byte)
		wantErr  assert.ErrorAssertionFunc
	}{
		{
			name: "Handle Gzip Encoding in HTTP/2 Response",
			args: args{raw: []byte(h2packet)},
			wantRsp: func(t *testing.T, rsp []byte) {
				assert.NotContains(t, string(rsp), "gzip")
				assert.NotContains(t, string(rsp), "Content-Encoding")
			},
			wantBody: func(t *testing.T, body []byte) {
				assert.Equal(t, "你好", string(body))
			},
			wantErr: assert.NoError,
		},
		{
			name:    "Handle Base64 Encoded Response",
			args:    args{raw: rawResp},
			wantRsp: nil,
			wantBody: func(t *testing.T, body []byte) {
				assert.Contains(t, string(body), "提交带有不合法参数", "响应体中应该包含文本 '提交带有不合法参数'")
			},
			wantErr: assert.NoError,
		},
		{
			name: "Handle Base64 Encoded Response 2",
			args: args{raw: chunk2},
			wantRsp: func(t *testing.T, rsp []byte) {
				assert.Contains(t, string(rsp), "charset=utf-8", "响应头中应该包含 'charset=utf-8'")
			},
			wantBody: func(t *testing.T, body []byte) {
				assert.Contains(t, string(body), "操作执行成功", "响应体中应该包含文本 '操作执行成功'")
			},
			wantErr: assert.NoError,
		},
		{
			name:    "Handle JSON Response with Chinese Characters",
			args:    args{raw: []byte(jsonChineseOrigin)},
			wantRsp: nil,
			wantBody: func(t *testing.T, body []byte) {
				body = []byte(codec.JsonUnicodeDecode(string(body)))
				assert.Contains(t, string(body), "抓马短星闻", "响应体应该包含 '抓马短星闻'")
			},
			wantErr: assert.NoError,
		},
		{
			name:    "Handle Gzip Encoding in HTTP/1.1 Response",
			args:    args{raw: []byte(rapInput)},
			wantRsp: nil,
			wantBody: func(t *testing.T, rsp []byte) {
				assert.Equal(t, "aaaaaaaaaaaa"+"\r\n\r\n", string(rsp), "响应内容应该与 'aaaaaaaaaaaa\\r\\n\\r\\n' 相匹配")
			},
			wantErr: assert.NoError,
		},
		{
			name:    "Handle json format response",
			args:    args{raw: []byte(jsonEcho)},
			wantRsp: nil,
			wantBody: func(t *testing.T, rsp []byte) {
				assert.Equal(t, `{"key":"value"}`, string(rsp), "响应内容应该与 '{\"key\":\"value\"}' 相匹配")
			},
			wantErr: assert.NoError,
		},
		{
			name: "Handle crlf in request",
			args: args{raw: []byte(debugCRLF)},
			wantRsp: func(t *testing.T, rsp []byte) {
				want := `POST /abc HTTP/1.1` + "\r\nHost: www.baidu.com\r\n\r\n"
				assert.Equal(t, want, string(rsp), "响应内容应该与 '"+want+"' 相匹配")
			},
			wantBody: func(t *testing.T, body []byte) {
				assert.Equal(t, ``, string(body), "响应内容应该为空")
			},
			wantErr: assert.NoError,
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			gotRsp, gotBody, err := FixHTTPResponse(tt.args.raw)
			if !tt.wantErr(t, err, fmt.Sprintf("FixHTTPResponse(%v)", tt.args.raw)) {
				return
			}
			if tt.wantRsp != nil {
				tt.wantRsp(t, gotRsp)
			}
			if tt.wantBody != nil {
				tt.wantBody(t, gotBody)
			}
		})
	}
}

func TestFixHTTPResponse1(t *testing.T) {
	raw := "485454502f312e31203230300d0a446174653a204672692c2032322044656320323032332031333a34313a333520474d540d0a436f6e74656e742d547970653a20746578742f68746d6c3b20636861727365743d7574662d380d0a436f6e74656e742d4c656e6774683a20323939320d0a0d0ac6493347306a7c5cfa3c33d86ce2448fde26c0bb1bfd1f3ce5dc6d2bb2ca98c09a1438cc0b591b0644f5bdb713df3da411c781a8e8e74737274ec2e65c0e9be6ba4169e793862aec0209b53b46c4021004ba427fee4bc59b1181502b1d7184c523bfeca812ba59f0ff886f7a0404c195c74a86389b25cb7f4de8cd35656dcec101fa0c3b86f3ac82e9ad9ff5dc57c189cccbd6a4280405f400c707552418cddbbd1287b86c048e0661e375616e421735f4c9aed516fdcbf2ba8f458d5a3d966e4982a7b1404db51ccb5cb6c3bc4ca620d1b623a3c89397a48499798ecdf50637b12444eac090a91ffba10cd41543fd5fe17277e8f267830b407d174ed89dbfb93c6d4b7383df0644e1a4b15fed8ad0ffc0e603dab63bbef4f62e884087a4d72d9829f92cd63e337dfc2eb53aae7e46aee352cf76e9e09c1176610575058aaaf93793c4cd8a86afd2f2f74e7e5ad38903861da919e34f270357e8475b6dca3b82fe69e1db3377e4783b498fd57ae632e563f246f0654c5b9bb7edbb99ebbf7d7cdede0ec9a739f426e174f7b855bf7fd6357f57e17f297865fec1473a86b5c8dac695a542c9d4d16ba40bac0c097f5e5c00837e068b3e69a2f7a62c89e8d106c68b913cc910b800ec9d25c8393edb56f1656f9a8a2849d9758a93397efa843c66d9b6c2ed3f6087338756b75434cdd4d1c0de75246a67e20b55d5240cafbe6619b0049f0fddbba27ed19cd9e837626ff1f97a478de9c4e815a1029b609178b4b7dab51717970bfd2f0378c7ad0daf8d21bd96947c54ade688689108fdf48d818100084070579ba6518017d479abf73c4fd8a5018ffacd2beec7d8da06bde94941f44f882a9c938dad86a89686baaa4d2d75a38e652869d2a7cfd34fdf804292250855a950d5a13610ca944615b0c12871ca8477fb85b2ab2bf2b8b022783d23ba0b71db380a294c612c75a12182e596aa9978613b6d3b9e835fb304a87873ad60d4438fa22cd4687a8aef811c8968e8f0a5326b61ec4951ba47bfde6b9a9d04c54aa6f774eeeb6119de2d852f39bb0c2b9e5d61e5696dbae35264c8538de2bfe90c0311c7b7d38877de7f9e33e2bf8b53d66a7808e08b55d78179ca15baf136384d9847b16c941348885a35621b52a85c13e5873bcd856c439edb08dd38000a0914b2d8a099cf2eabd014af63a45b671181f7f9f4e2417a2f3683d499993ce177aa22c262f4d71fc07563aeed0fbecab85d489dcde0c139514e8c0febb082b2d844809be3a59fe09a0c98913b94921f4fcfec1a93381c7df290787075ede5c2008ae4e26a353c4c9db1e9342aff0d2935f3c8b4f8bae29ce9a81d78938584e65f203683559716f9c2a4321887eece1a625aecef8d5d6bb84bab85f0199523bec3e0a6afdadb0e35ea9ca10b91c43849d3916eb8f5c7db5878b0a648f2e8ef73e1b08ac816e525a7f4c4796c2df90944134699a9eaf3ceea40f1b39e6c47814f197c15dcc704911fbb66485a15a31ee32aaa0da7fb6e7db07a2d56a821109150f8ebf84ac932d83a331d9d3b2e5a95c6b2c3451ee9168ed55e20095423e6fad3ec7b8ac6f0995d0db019fd7d70557060ced03c5eb0963bd249be54622d3cfe3be3c504b32d718fd6112d751579bfc503a3145118e4ed5cd3119f5515240096ac545547dae56e4ea8a7629954f4523d332f7a0b1ebaacad767065d86f23284c5b37c2c14c8fd4407b066e4f835521279600b04185049e750891ca666a37af5ae45a2cdefc605ebdd1baf34da4c7968aa0bee4edef3354b31bf47d54c2f2414eebd35c92af3fdba6aff48b3ed28f828e15473b68bf47c6e62169768f302b099db0c2c9f8d59ae1a66bec8adcd1cfc3174485fd4ca85925f5666fdbf0d7248eaaa13d2337d03146b8efe35701ae200b63a6900a08c2d350598ed4356e50eb57a344fc17ec1bb8d86fb07641a7f18478af44eed48e3d630a3e56980bb839e2ca6854c8863f2084d71bbc1c8dd872f5b38deb74a23262ac7f535c0ae307b5e1eff0a65b3feb58d7221cf5b1fec78e34e5b876f58561a23ac5f9e66c980b7d3f44df35962c4e17c95ab7db58b85a4f7f1839ea8e024ec3ffdb0f5962c269582bb52beb03a00ed38c8e087e21ad06a3c3ef1718545fb838905105dc736afb0ca5a04a72922f34460fa9d8005c7965e2ebcfebd72c39502c663bab10923e601e5965ab8332103671df9af11a978b160030fa1f63ea8e96e80a98c5e4adcd726bec8d1bee4037b05f50347a5d422cc306d8606392d0864a49799c7289ab075c749f4403e993ce18d18940742bbfe34f4ede43755c077be0b932bc649657dd6329ec2cef147e91fc7c6045658616e3c2d0d65f8a6b877c0966b0b4ef0830e6d7ccf4658b0ad60bbf396b4826c22d8e578ce534ba073f5b80397640370b007964fd2de2da52cbe61e7027fa7043a74e637cb5c90d8fa3cf80b7fde596250704a718cffe7a075e32cec6fb2876fdd0e01d114375862672cf793c9ac4e8144c0e6aecfccacceaa6fc47971c66df59bd1533b00b17e8594716af469fe260cd6e0ec0ed508d8c81f4c1da06680b0bcf2004cdb7b3cd940fd8f3134623cff706438b0cc5bd89bd7c01895ebf2533551b4f287e3db81b26e99e051d72dd551832396bfbfaf929128457ce3487bb0016b9b6e5c9be8dd03577dfe7319ac7d3076b7a1c6672394471d0c8fd033e57d73456ff53fcbb36b1ca09e307e69d1c637cf2fd4d0c06768b4c50ae98955049707969bd20961afff3e128357b22e6128bd6b6aca45c70ac9e2758d47c50a18a649522bcd5d7a138dc68607225256ec68c1b7f6e13c3e77f0674c5169c8fd6f97961aaceadc46d577d50c1bcb1b34fdd25efe6a20356e163e7effaa4e6c7d63624fc98335027f8898ef5589e3d7a0f59113a7872290b7cc4f2d19de227fa7d6174107364a427c46c59fcbc9a331ddf3c741d99b5e2484bdf758cca5123974298bb83b296111f2790825fd878a114f4b79a582d312f24875809c8de6577dfb4dd40863bad77931008c8957fd075a0ad5aaf32ef4916c0dcf21db038fd7155f8c264a071a1248bc9cf0a436cd7d130e6c886509bbebeeaa4925fa80397e22af93c68406fb70694926064ce9dbe8039747c9c0c1096eead303a612afece082e0e0280f9d3460ce36818ca781a0d9efd27476b192b3b67bb5638f763bc7a9c24a986d054c275161820d8443b93d7c0057a8683038c91cbbe4e14950eddf396ddfd75124f3220a6af0c9a4659183ef1177a2badf25e7c8305f20032ca8603724c2b6e18e7c1471281ddf8f47ee5b7433a4cc59c6692dde871928d936b375d44875487d5ae8440ca89ee084e52abf5dc92d61e9b473a2c0977830c47d3b5b5f17203f0580f65bdc5759e4e173552956cebef6a6e40e27ce7c904b7ec385658b1e9eca031306f2ec3f4059c55ab438fddeee7671e9c61f9dc09bb380af7d92967221872cfbfc3cd036be229744f2cda5399679419766e3b9298e0454640d3074a1db5a551dcd601b3bd6582c71b51240535fc03259d2138166e3e081117a8bb448c5511458e4e205064c46755cf02ea977d41137b707a5548ccd66112bf79d74f35cd2962529d4f4863fd9e81330c59350bb16a79733affc030fa6d057c918d7224d582dee6d8471a43f8195e9a13a74d43b6feb429485d08d7d4ef2723743a8c387b69cd192c5ff781d935f84283efbc27d14258e322be2077dc4699b1f4923a38a20d0d7a84cba063c90913c6bf73af8ab62637ecaffba1f11eb7c4595d0d8114926d4a08e1c04f55b2abe9ad39875b03affc74a8a0dbb367f7dffc02d3304b3e9a768326482fd41ce487433df8e841d4770a39306cc5fdba7c86d45709ca759970abf4843db5cac04be0cf9f22aae96b3352a6b0f036fa5deed532274c8d33326d2859796c27e140be7faad8c1caa51f71ed26f47dcd0086443ed7b90929c8e63a8e70eb57fdd8bdbc0500c104ff224c87763077c71296bce5fcf1408a8fcb1cdcfc567bd66ce4f706a8190962fedf3cadb1bd10808b80c5d17827d95261c8a6ad33d2f78e00bf6b9b1b37779e63d4569bc18c3cc6e0fbbd3e6b1787b03676c77041f838d14ed26b3cd1c4049116104bb1d3fecb7be44ad567be04ed46814291c0922c1fbb093cc792bee678266a35ecdc1cbe97090f44ff200c776bd24383a93cae7462fe8d3e9f92b88be240f4"
	resp, _ := hex.DecodeString(raw)
	_, gotBody, err := FixHTTPResponse(resp)
	if err != nil {
		fmt.Println(err)
	}
	// fmt.Println(string(gotRsp))
	fmt.Println(hex.EncodeToString(gotBody))
}

func TestFixZstdHTTPResponse(t *testing.T) {
	var buf bytes.Buffer
	writer, err := zstd.NewWriter(&buf, zstd.WithEncoderLevel(zstd.SpeedDefault))
	require.NoError(t, err)
	bodyRaw := []byte("你好")
	writer.Write(bodyRaw)
	writer.Flush()
	writer.Close()

	encoded := buf.Bytes()
	log.Infof("encoded: %v", encoded)
	packet := append([]byte(fmt.Sprintf(`HTTP/1.1 200 Ok
Content-Length: %d
Content-Encoding: zstd

`, len(encoded))), encoded...)
	_, gotBody, err := FixHTTPResponse(packet)
	require.NoError(t, err)
	require.Equal(t, gotBody, bodyRaw)
}
