{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "required": ["@action"],
  "properties": {
    "@action": {
      "type": "string",
      "enum": ["continue-current-task", "proceed-next-task", "task-failed", "task-skipped"],
      "description": "基于对当前执行中子任务（在任务树中标记为“执行中”状态）的**退出条件评估**，决定任务流的下一步行动。此字段用于指示AI在评估当前子任务状态后应采取的四种预定义操作之一。",
      "enumDescriptions": {
        "continue-current-task": "当评估后认为当前子任务**尚未满足其既定完成条件（即退出条件未达成）**时选择此项。AI应通过此操作**申请必要的工具调用或执行进一步的内部处理**，以继续推进当前子任务的执行。",
        "proceed-next-task": "当评估后确认当前子任务**已成功完成并满足其所有退出条件**时选择此项。此操作将**正式结束当前子任务**，并使任务流**前进到计划中的下一个子任务**。",
        "task-failed": "当当前子任务在执行过程中遭遇**无法恢复的致命错误或关键性障碍**，导致其无法继续或无法达成目标时选择此项。此操作将**标记当前任务为失败状态，并通常会导致整个任务规划的终止或进入错误处理流程**。",
        "task-skipped": "当AI判断当前子任务因**多次尝试失败、执行成本过高、与整体目标关联性减弱或变得不再必要**时选择此项。此操作将**显式放弃当前子任务的执行，并允许任务流跳过此任务，继续处理后续子任务**。"
      }
    },
    "status_summary": {
      "type": "string",
      "description": "当 `@action` 为 `continue-current-task` 时**必需提供**。此字段用于**记录和总结当前子任务在本次执行迭代中的具体进展、遇到的问题、已尝试的解决步骤、以及任何需要传递给下一次迭代（针对同一子任务）的关键上下文信息**。其核心目的是确保任务在多次尝试中能够持续推进，并为AI后续的决策（例如，调整策略、选择不同工具或参数）提供充分的、结构化的信息依据。也可用于追踪如重试次数、累积的部分成果等中间状态数据。"
    },
    "task_long_summary": {
      "type": "string",
      "description": "当子任务通过 `proceed-next-task` 成功完成时**可选提供**。这是一个**详尽的任务完成总结**，旨在全面记录该子任务的完整执行过程、最终取得的成果、关键的发现与洞察、执行期间遇到的挑战及其对应的解决方案等。**建议将长度控制在300个Token左右**。此总结主要用于支持后续的详细复盘、知识库构建，或在复杂项目中对特定阶段性成果进行详细的归档和说明。"
    },
    "task_short_summary": {
      "type": "string",
      "description": "当子任务通过 `proceed-next-task` 成功完成时**强烈建议提供**；当通过 `task-skipped` 或 `task-failed` 结束时也**可以提供**（用于简要记录跳过或失败的核心原因与状态）。这是一个**高度凝练的任务成果或最终状态摘要**，务必确保**只包含最核心、不可删减的关键信息**（例如，主要产出物的引用、关键性能指标的达成情况）。此短摘要将**持久化并用于后续所有相关的进度展示、上下文回顾以及传递给后续任务的必要信息**。若需向后续任务传递具有直接影响的建议、前置条件变更或潜在风险提示，也应在此字段中明确扼要地指出。"
    },
    "shrink_similar_tool_call_result": {
      "type": "string",
      "x-generation-rules": [
        "如果当前时间线上没有其他工具调用，则不需要压缩，设置为空",
        "这个规则只在你觉得工具调用结果会干扰到后续的工具调用时才需要使用，不必每次都使用"
      ],
      "description": "用于**优化和压缩内容高度相似的连续工具调用结果**。当AI检测到当前工具调用的输出与先前某次工具调用（需通过其唯一ID进行引用）的结果存在大量重复内容时，应在此字段中**仅明确呈现本次调用结果中与被引用结果有差异的部分或新增信息**，并将重复内容以标准化占位符（例如：`...[内容与工具调用ID:xx相似]...` 或 `...[大部分内容与工具调用ID:yy的输出一致，新增/修改部分如下：...]...`）表示。**此机制旨在显著减少传递给模型的上下文长度，缓解token压力，提升后续处理效率**。请严格参考 `x-generation-rules` 中列出的具体应用条件与判断逻辑。"
    },
    "summary_tool_call_result": {
      "type": "string",
      "description": "用于**对单个特定工具调用的完整输出进行结构化、信息化的摘要**。当原始工具调用结果非常冗长（例如，大段的日志、HTML源码或API响应），或者随着任务的推进，某些旧的工具调用完整结果不再需要逐字保留时，可以使用此字段来记录该工具调用的**核心输入参数、关键执行步骤（如果适用且重要）、以及最重要的输出结果、结论或提取的关键数据点**。其目的是在有效压缩上下文信息量的同时，**保留该工具调用的核心价值和可追溯信息**，以便在后续分析或决策中仍能理解其在该时间点的作用和具体产出，避免信息丢失。"
    }
  }
}
