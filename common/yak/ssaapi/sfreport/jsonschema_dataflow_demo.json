{
  "path_id": "path_1323",
  "description": "Data flow path for path-traversal vulnerability in 7a8f7821-0d17-4501-9f10-5b141c0e74a6",
  "nodes": [
    {
      "node_id": "n2",
      "ir_code": "add(add(Undefined-System.currentTimeMillis(Undefined-System), \"_\"), Parameter-fileName)",
      "source_code": "        }\n\n        // 5. 生成安全的文件名（避免覆盖现有文件）\n        String safeFileName = System.currentTimeMillis() + \"_\" + fileName;\n        Path destination = uploadDir.resolve(safeFileName);\n\n        // 6. 保存文件\n",
      "source_code_start": 0,
      "code_range": {
        "url": "/7a8f7821-0d17-4501-9f10-5b141c0e74a6/FileUploader.java",
        "start_line": 64,
        "start_column": 31,
        "end_line": 64,
        "end_column": 74,
        "source_code_line": 60
      }
    },
    {
      "node_id": "n4",
      "ir_code": "Undefined-uploadDir.resolve(Undefined-Paths.get(Paths,\"/var/www/uploads/\",phi(ternary_expression)[Parameter-subDir,\"\"]),add(add(Undefined-System.currentTimeMillis(Undefined-System), \"_\"), Parameter-fileName))",
      "source_code": "\n        // 5. 生成安全的文件名（避免覆盖现有文件）\n        String safeFileName = System.currentTimeMillis() + \"_\" + fileName;\n        Path destination = uploadDir.resolve(safeFileName);\n\n        // 6. 保存文件\n        Files.copy(inputStream, destination, StandardCopyOption.REPLACE_EXISTING);\n",
      "source_code_start": 0,
      "code_range": {
        "url": "/7a8f7821-0d17-4501-9f10-5b141c0e74a6/FileUploader.java",
        "start_line": 65,
        "start_column": 38,
        "end_line": 65,
        "end_column": 59,
        "source_code_line": 61
      }
    },
    {
      "node_id": "n6",
      "ir_code": "Undefined-Files.copy(Files,Parameter-inputStream,Undefined-uploadDir.resolve(Undefined-Paths.get(Paths,\"/var/www/uploads/\",phi(ternary_expression)[Parameter-subDir,\"\"]),add(add(Undefined-System.currentTimeMillis(Undefined-System), \"_\"), Parameter-fileName)),Undefined-StandardCopyOption.REPLACE_EXISTING)",
      "source_code": "        Path destination = uploadDir.resolve(safeFileName);\n\n        // 6. 保存文件\n        Files.copy(inputStream, destination, StandardCopyOption.REPLACE_EXISTING);\n\n        // 7. 返回相对路径（不暴露服务器绝对路径）\n        return Paths.get(subDir != nil ? subDir : \"\", safeFileName).toString();\n",
      "source_code_start": 0,
      "code_range": {
        "url": "/7a8f7821-0d17-4501-9f10-5b141c0e74a6/FileUploader.java",
        "start_line": 68,
        "start_column": 15,
        "end_line": 68,
        "end_column": 82,
        "source_code_line": 64
      }
    },
    {
      "node_id": "n8",
      "ir_code": "Undefined-Files.copy",
      "source_code": "        Path destination = uploadDir.resolve(safeFileName);\n\n        // 6. 保存文件\n        Files.copy(inputStream, destination, StandardCopyOption.REPLACE_EXISTING);\n\n        // 7. 返回相对路径（不暴露服务器绝对路径）\n        return Paths.get(subDir != nil ? subDir : \"\", safeFileName).toString();\n",
      "source_code_start": 0,
      "code_range": {
        "url": "/7a8f7821-0d17-4501-9f10-5b141c0e74a6/FileUploader.java",
        "start_line": 68,
        "start_column": 15,
        "end_line": 68,
        "end_column": 19,
        "source_code_line": 64
      }
    },
    {
      "node_id": "n9",
      "ir_code": "Files",
      "source_code": "import java.io.File;\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.nio.file.Files;\nimport java.nio.file.Path;\nimport java.nio.file.Paths;\nimport java.nio.file.StandardCopyOption;\n",
      "source_code_start": 0,
      "code_range": {
        "url": "/7a8f7821-0d17-4501-9f10-5b141c0e74a6/FileUploader.java",
        "start_line": 4,
        "start_column": 1,
        "end_line": 4,
        "end_column": 28,
        "source_code_line": 0
      }
    },
    {
      "node_id": "n1",
      "ir_code": "Parameter-fileName",
      "source_code": "     * @throws IOException 如果上传过程中发生错误\n     * @throws SecurityException 如果检测到不安全操作\n     */\n    public static String uploadFile(InputStream inputStream, String fileName, String subDir)\n            throws IOException, SecurityException {\n\n        // 1. 检查文件名是否合法\n",
      "source_code_start": 0,
      "code_range": {
        "url": "/7a8f7821-0d17-4501-9f10-5b141c0e74a6/FileUploader.java",
        "start_line": 24,
        "start_column": 62,
        "end_line": 24,
        "end_column": 77,
        "source_code_line": 20
      }
    }
  ],
  "edges": [
    {
      "edge_id": "e0",
      "from_node_id": "n1",
      "to_node_id": "n2",
      "edge_type": "depend_on",
      "description": "The dependency edge in the dataflow, DependOn indicates which other values the current value depends on. For example, A DependOn B means Value A depends on Value B."
    },
    {
      "edge_id": "e1",
      "from_node_id": "n2",
      "to_node_id": "n4",
      "edge_type": "depend_on",
      "description": "The dependency edge in the dataflow, DependOn indicates which other values the current value depends on. For example, A DependOn B means Value A depends on Value B."
    },
    {
      "edge_id": "e2",
      "from_node_id": "n4",
      "to_node_id": "n6",
      "edge_type": "depend_on",
      "description": "The dependency edge in the dataflow, DependOn indicates which other values the current value depends on. For example, A DependOn B means Value A depends on Value B."
    },
    {
      "edge_id": "e3",
      "from_node_id": "n9",
      "to_node_id": "n8",
      "edge_type": "search-exact:copy",
      "description": "Search value from database exactly"
    },
    {
      "edge_id": "e4",
      "from_node_id": "n8",
      "to_node_id": "n6",
      "edge_type": "call",
      "description": "Function call"
    }
  ],
  "dot_graph": "strict digraph {\n    rankdir = \"BT\";\n    n4 [label=\"resolve(safeFileName)\"]\n    n6 [label=\"copy(inputStream, destination, StandardCopyOption.REPLACE_EXISTING)\"]\n    n8 [label=\"copy\"]\n    n9 [label=\"import java.nio.file.Files;\"]\n    n1 [label=\"String fileName\", style=\"filled\", fillcolor=\"lightyellow\", color=\"orange\", penwidth=\"3.0\", fontcolor=\"darkorange\"]\n    n2 [label=\"System.currentTimeMillis() + \\\"_\\\" + fileName\"]\n    n8 -\u003e n6 [label=\"call\", color=\"red\", fontcolor=\"red\", penwidth=\"3.0\"]\n    n1 -\u003e n2 [label=\"depend_on\"]\n    n2 -\u003e n4 [label=\"depend_on\"]\n    n4 -\u003e n6 [label=\"depend_on\"]\n    n9 -\u003e n8 [label=\"search-exact:copy\", color=\"red\", fontcolor=\"red\", penwidth=\"3.0\"]\n}\n"
}