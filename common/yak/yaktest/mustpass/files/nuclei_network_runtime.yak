host, port := tcp.MockServe(f`asdfiofasjkdfkasdfasd. ${codec.DecodeHex('0700000200000002000000')~} asdjofasdjklfasjkldasd`)
dump(str.HostPort(host, port))
var matched = false
var runtime = ""
nuclei.ScanAuto(str.HostPort(host, port), nuclei.runtimeId("abc"), nuclei.timeout(3), nuclei.debug(true), nuclei.rawTemplate(`
id: tidb-unauth

info:
  name: TiDB - Unauthenticated Access
  author: lu4nx
  severity: high
  description: TiDB server was able to be accessed because no authentication was required.
  metadata:
    zoomeye-query: tidb +port:"4000"
  tags: network,tidb,unauth

network:
  - inputs:
      - read: 1024              # skip handshake packet
      - data: b200000185a6ff0900000001ff0000000000000000000000000000000000000000000000726f6f7400006d7973716c5f6e61746976655f70617373776f72640075045f70696406313337353030095f706c6174666f726d067838365f3634035f6f73054c696e75780c5f636c69656e745f6e616d65086c69626d7973716c076f735f757365720578787878780f5f636c69656e745f76657273696f6e06382e302e32360c70726f6772616d5f6e616d65056d7973716c  # authentication
        type: hex

    host:
      - "{{Hostname}}"

    read-size: 1024

    matchers:
      - type: binary
        binary:
          # resp format:
          # 07: length, 02: sequence number, 00: success
          - "0700000200000002000000"

# Enhanced by mp on 2022/07/20

`), nuclei.tcpResultCallback(s => {
    if s.match {
        matched = true
    }
    dump(s.runtimeId)
    runtime = s.runtimeId
}))

if !matched{
    panic("BasicSmoking for nuclei.AutoScan - network!")
}

assert runtime == "abc"
