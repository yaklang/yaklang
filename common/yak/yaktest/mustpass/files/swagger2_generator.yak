count = 0
err = openapi.GenerateHTTPFlows(codec.DecodeBase64(`c3dhZ2dlcjogJzIuMCcKaW5mbzoKICB2ZXJzaW9uOiAnMS4wLjAnCiAgdGl0bGU6IFNpbXBsZSBVc2VyIEFQSQogIGRlc2NyaXB0aW9uOiBBIHNpbXBsZSBBUEkgdG8gcmV0cmlldmUgYW5kIG1hbmFnZSB1c2VycwogIHRlcm1zT2ZTZXJ2aWNlOiAnaHR0cDovL2V4YW1wbGUuY29tL3Rlcm1zLycKICBjb250YWN0OgogICAgbmFtZTogQVBJIFN1cHBvcnQKICAgIHVybDogJ2h0dHA6Ly93d3cuZXhhbXBsZS5jb20vc3VwcG9ydCcKICAgIGVtYWlsOiBzdXBwb3J0QGV4YW1wbGUuY29tCiAgbGljZW5zZToKICAgIG5hbWU6IEFwYWNoZSAyLjAKICAgIHVybDogJ2h0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMC5odG1sJwpob3N0OiAnYXBpLmV4YW1wbGUuY29tJwpiYXNlUGF0aDogJy92MScKc2NoZW1lczoKICAtIGh0dHAKY29uc3VtZXM6CiAgLSBhcHBsaWNhdGlvbi9qc29uCnByb2R1Y2VzOgogIC0gYXBwbGljYXRpb24vanNvbgoKcGF0aHM6CiAgL3VzZXJzOgogICAgZ2V0OgogICAgICBzdW1tYXJ5OiBMaXN0IGFsbCB1c2VycwogICAgICBkZXNjcmlwdGlvbjogUmV0dXJucyBhIGxpc3Qgb2YgYWxsIHVzZXJzIGluIHRoZSBzeXN0ZW0KICAgICAgcmVzcG9uc2VzOgogICAgICAgICcyMDAnOgogICAgICAgICAgZGVzY3JpcHRpb246IEFuIGFycmF5IG9mIHVzZXJzCiAgICAgICAgICBzY2hlbWE6CiAgICAgICAgICAgIHR5cGU6IGFycmF5CiAgICAgICAgICAgIGl0ZW1zOgogICAgICAgICAgICAgICRyZWY6ICcjL2RlZmluaXRpb25zL1VzZXInCiAgICBwb3N0OgogICAgICBzdW1tYXJ5OiBDcmVhdGUgYSB1c2VyCiAgICAgIGRlc2NyaXB0aW9uOiBDcmVhdGVzIGEgbmV3IHVzZXIgaW4gdGhlIHN5c3RlbQogICAgICBwYXJhbWV0ZXJzOgogICAgICAgIC0gaW46IGJvZHkKICAgICAgICAgIG5hbWU6IHVzZXIKICAgICAgICAgIGRlc2NyaXB0aW9uOiBUaGUgdXNlciB0byBjcmVhdGUKICAgICAgICAgIHNjaGVtYToKICAgICAgICAgICAgJHJlZjogJyMvZGVmaW5pdGlvbnMvVXNlcicKICAgICAgcmVzcG9uc2VzOgogICAgICAgICcyMDEnOgogICAgICAgICAgZGVzY3JpcHRpb246IFVzZXIgY3JlYXRlZAogICAgICAgICc0MDAnOgogICAgICAgICAgZGVzY3JpcHRpb246IEludmFsaWQgdXNlciBpbnB1dAoKZGVmaW5pdGlvbnM6CiAgVXNlcjoKICAgIHR5cGU6IG9iamVjdAogICAgcmVxdWlyZWQ6CiAgICAgIC0gaWQKICAgICAgLSBuYW1lCiAgICBwcm9wZXJ0aWVzOgogICAgICBpZDoKICAgICAgICB0eXBlOiBpbnRlZ2VyCiAgICAgICAgZm9ybWF0OiBpbnQ2NAogICAgICBuYW1lOgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICBlbWFpbDoKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgcGhvbmU6CiAgICAgICAgdHlwZTogc3RyaW5n`)~, openapi.flowHandler(flow => {
    count++
    println(codec.StrconvUnquote(flow.Response)~)
}))
die(err)
assert count >= 3

host, port = tcp.MockServe(`HTTP/1.1 200 OK
Content-Length: 0

`)

poc.Get(f`http://${str.HostPort(host, port)}/abc`, poc.save(true), poc.saveSync(true))~
poc.Get(f`http://${str.HostPort(host, port)}/abce`, poc.save(true), poc.saveSync(true))~
poc.Get(f`http://${str.HostPort(host, port)}/abce`, poc.save(true), poc.saveSync(true))~
poc.Get(f`http://${str.HostPort(host, port)}/abce/aaa`, poc.save(true), poc.saveSync(true))~
poc.Get(f`http://${str.HostPort(host, port)}/abce/aaccc`, poc.save(true), poc.saveSync(true))~

hostport = str.HostPort(host, port)

result = openapi.ExtractOpenAPI3Scheme(hostport)~
raw = result.MarshalJSON()~
assert str.MatchAllOfSubString(raw, `/abc`, `/abce`, `/abce/aaa`, `/abce/aaccc`)