package yserx

import (
	"bytes"
	"github.com/yaklang/yaklang/common/yak/yaklib/codec"
	"os"
	"testing"
)

func TestParseJavaSerializedEx(t *testing.T) {
	origin := "aced0005737200176a6176612e7574696c2e4c696e6b656448617368536574d86cd75a95dd2a1e020000787200116a6176612e7574696c2e48617368536574ba44859596b8b7340300007372003a636f6d2e73756e2e6f72672e6170616368652e78616c616e2e696e7465726e616c2e78736c74632e747261782e54656d706c61746573496d706c09574fc16eacab3303000549000d5f696e64656e744e756d62657249000e5f7472616e736c6574496e6465785a00155f75736553657276696365734d656368616e69736d5b000a5f62797465636f6465737400035b5b424c00055f6e616d657400124c6a6176612f6c616e672f537472696e673b787000000001ffffffff01757200035b5b424bfd19156767db37020000787000000001757200025b42acf317f8060854e0020000787000000206cafebabe00000033001c01001f79736f73657269616c2f50776e6572313135303137383032343835373132350700010100106a6176612f6c616e672f4f626a65637407000301000a536f7572636546696c6501001a50776e6572313135303137383032343835373132352e6a6176610100083c636c696e69743e010003282956010004436f64650100116a6176612f6c616e672f52756e74696d6507000a01000a67657452756e74696d6501001528294c6a6176612f6c616e672f52756e74696d653b0c000c000d0a000b000e0100286f70656e202f53797374656d2f4170706c69636174696f6e732f43616c63756c61746f722e61707008001001000465786563010027284c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f50726f636573733b0c001200130a000b001401000d537461636b4d61705461626c65010040636f6d2f73756e2f6f72672f6170616368652f78616c616e2f696e7465726e616c2f78736c74632f72756e74696d652f41627374726163745472616e736c65740700170100063c696e69743e0c001900080a0018001a0021000200180000000000020008000700080001000900000024000300020000000fa70003014cb8000f1211b6001557b100000001001600000003000103000100190008000100090000001100010001000000052ab7001bb1000000000001000500000002000674000361626377010078737200296a6176612e6265616e732e6265616e636f6e746578742e4265616e436f6e74657874537570706f7274bc4820f0918fb90c03000149000c73657269616c697a61626c657872002e6a6176612e6265616e732e6265616e636f6e746578742e4265616e436f6e746578744368696c64537570706f727457d4efc704dc72250300014c00146265616e436f6e746578744368696c64506565727400294c6a6176612f6265616e732f6265616e636f6e746578742f4265616e436f6e746578744368696c643b787071007e000e78000000017372003273756e2e7265666c6563742e616e6e6f746174696f6e2e416e6e6f746174696f6e496e766f636174696f6e48616e646c657255caf50f15cb7ea50300024c000c6d656d62657256616c75657374000f4c6a6176612f7574696c2f4d61703b4c0004747970657400114c6a6176612f6c616e672f436c6173733b7870737200116a6176612e7574696c2e486173684d61700507dac1c31660d103000246000a6c6f6164466163746f724900097468726573686f6c6478703f4000000000000c77080000001000000001740008663561356136303871007e0005787672001d6a617661782e786d6c2e7472616e73666f726d2e54656d706c6174657300000000000000000300007870770400000000787870770c000000103f4000000000000271007e0005737d00000001001d6a617661782e786d6c2e7472616e73666f726d2e54656d706c61746573787200176a6176612e6c616e672e7265666c6563742e50726f7879e127da20cc1043cb0200014c0001687400254c6a6176612f6c616e672f7265666c6563742f496e766f636174696f6e48616e646c65723b787071007e001278"
	raw, _ := codec.DecodeHex(origin)
	objs, err := ParseJavaSerializedEx(bytes.NewBuffer(raw), os.Stdout)
	if err != nil {
		panic(err)
	}
	_ = objs
	if objs == nil {
		panic("err! for parsing")
	}

	if codec.EncodeToHex(MarshalJavaObjects(objs...)) != origin {
		panic(1)
	}
}
